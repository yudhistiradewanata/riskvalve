@{
    ViewData["Title"] = "Assessment";
    var CurrentConditionLimitStateModel = new CurrentConditionLimitStateModel();
    var limitState = CurrentConditionLimitStateModel.GetConditionLimitStates();

    var InspectionEffectivenessModel = new InspectionEffectivenessModel();
    var inspectionEffectivenessStates = InspectionEffectivenessModel.GetInspectionEffectivenessStates();

    var IsValveRepairedModel = new IsValveRepairedModel();
    var isValveRepairedStates = IsValveRepairedModel.GetIsValveRepairedList();

    var InspectionMethodModel = new InspectionMethodModel();
    var inspectionMethods = InspectionMethodModel.GetInspectionMethods();

    var TimeToLimitStateModel = new TimeToLimitStateModel();
    var timeToLimitStates = TimeToLimitStateModel.GetTimeToLimitStates();

    var ImpactEffectModel = new ImpactEffectModel();
    var impactEffectStates = ImpactEffectModel.GetImpactEffectStates();

    var UsedWithinOEMSpecificationModel = new UsedWithinOEMSpecificationModel();
    var usedWithinOEMSpecifications = UsedWithinOEMSpecificationModel.GetUsedWithinOEMSpecifications();

    var RepairedModel = new RepairedModel();
    var repairedStates = RepairedModel.GetRepairedStates();

    var HSSEDefinisionModel = new HSSEDefinisionModel();
    var hsseDefinisions = HSSEDefinisionModel.GetHSSEDefinisions();

    var defaultDate = ViewData["date"] as string;
    string baseurl = Url.Action("","");
    string urlassessmentupdate = Url.Action("UpdateAssessment", "Assessment");
    string urlassessmentdelete = Url.Action("DeleteAssessment", "Assessment");
    string urlassessmentadd = Url.Action("AddAssessment", "Assessment");
    string urlassessmentprint = Url.Action("PrintAssessment", "Assessment");
    string urlassetdetail = Url.Action("GetAssetDetail", "AssetRegister");
    string urlassessmentdetail = Url.Action("GetAssessmentDetail", "Assessment");
    string urlassessmentinspection = Url.Action("GetInspectionList", "Inspection");
    string urlassessmentmaintenance = Url.Action("GetMaintenanceList", "Maintenance");
    string urlinspectiondetail = Url.Action("GetInspectionDetail", "Inspection");
    string urlmaintenancedetail = Url.Action("GetMaintenanceDetail", "Maintenance");
}
    <div class="container-fluid">
        <div class="row">
            <div class="sidebar border border-right col-md-3 col-lg-2 p-0 bg-body-tertiary">
                <b class="inspection-sidebar-title">Risk Assessment</b>
                <partial name="InspectionAssessmentSidebar" />
            </div>
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 with-bg-image" style="background-image:url('@baseurl/lib/images/u45.png')">
                <div>
                    <ul class="nav nav-tabs nav-tab-menus" id="inspectiontabheader" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" href="#welcome" data-bs-toggle="tab" data-bs-target="#welcome" type="button" role="tab">
                                Welcome
                            </a>
                        </li>
                        <li class="nav-item" id="template_inspection_header">
                            <a
                                href="#inspection1" data-bs-toggle="tab"
                            >New Assessment Template
                                <button 
                                    type="button"
                                    class="btn-close-inspection"
                                ><i class="fa-solid fa-xmark"></i></button>
                            </a>
                        </li>
                    </ul>
                    <div class="tab-content" id="tabcontentcontainer">
                        <div class="tab-pane active show" id="welcome">
                            <div class="assessment-welcome">
                                <div class="content">
                                    <h3>Welcome to Assessment</h3>
                                    <div>To start conducting assessment, please choose valve asset in the tree view.</div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="template_inspection">
                            <form class="assessment-form">
                                <div class="row">
                                    <div class="col-lg-2">
                                        <div class="assessment-tab-content-submenu">
                                            <div class="submenu-item active" onclick="changeContentCard('valveproperties', this)"><i class="bi bi-card-list"></i> Valve Properties</div>
                                            <div class="submenu-item" onclick="changeContentCard('inspectionhistory', this)"><i class="bi bi-clock-history"></i> Inspection History</div>
                                            <div class="submenu-item" onclick="changeContentCard('maintenancehistory', this)"><i class="bi bi-clock-history"></i> Maintenance History</div>
                                            <div class="submenu-item" onclick="changeContentCard('riskassessment', this)"><i class="bi bi-search"></i> Risk Assessment</div>
                                            <div class="submenu-item" onclick="changeContentCard('riskmatrix', this)"><i class="bi bi-bar-chart"></i> Risk Matrix</div>
                                            <div class="submenu-item" onclick="changeContentCard('integrityplan', this)"><i class="bi bi-calendar2-check"></i> Integrity Plan</div>
                                        </div>
                                        <div class="submenu-action">
                                            <div class="top-row">
                                                <button type="button" class="btn btn-block btn-primary btn-maincolor submit-button" onclick="submitForm(this)"><i class="bi bi-save"></i> Save</button>
                                                <a  target="_blank" class="print-button"><button type="button" class="btn btn-block btn-warning" id="btn-print"><i class="bi bi-printer"></i> Print</button></a>
                                            </div>
                                            <div class="bottom-row">
                                                <button type="button" class="btn btn-block btn-danger delete-button" id="btn-delete" onclick="deleteForm(this)"><i class="bi bi-trash"></i> Delete</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-10">
                                        <div class="assessment-content-card card-group-valveproperties first-in-group active">
                                            <div class="card-header">
                                                Asset Information
                                            </div>
                                            <div class="card-content">
                                                <input type="hidden" name="Id" id="data-id">
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-assetid">Asset ID</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-assetid" name="AssetID" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-tagno">Tag No</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-tagno" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-equipmentname">Equipment Name</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-equipmentname" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-businessarea">Business Area</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-businessarea" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-platform">Platform</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-platform" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-parentequipmentno">Parent Equipment No.</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-parentequipmentno" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-parentequipmentdesc">Parent Equipment Description</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-parentequipmentdesc" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-installationdate">Installation Date</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-installationdate" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-pidno">PID No</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-pidno" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-valvetype">Valve Type</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-valvetype" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-manufacturer">Manufacturer</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-manufacturer" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-bodymaterial">Body Material</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-bodymaterial" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-bodymodel">Body Model</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-bodymodel" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-endconnection">End Connection</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-endconnection" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-serialno">Serial No</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-serialno" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-usagetype">Usage Type</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-usagetype" readonly>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-size">Size (inch)</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-size" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-classrating">Class Rating</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-classrating" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-servicefluid">Service Fluid</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-servicefluid" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-fluidphase">Fluid Phase</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-fluidphase" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-flowrate">Flow Rate (m3/hr)</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-flowrate" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-operatingtemperature">Operating Temperature (F)</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-operatingtemperature" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-operatingpressure">Operating Pressure (Psig)</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-operatingpressure" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-toxicorflamableliquid">Toxic or Flamable Liquid</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-toxicorflamableliquid" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-costofreplacement">Cost of replacement and repair (USD)</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-costofreplacement" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-actuatormfg">Actuator Mfg</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-actuatormfg" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-actuatorserialno">Actuator Serial No.</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-actuatorserialno" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-actuatortypemodel">Actuator Type/Model</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-actuatortypemodel" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-actuatorpower">Actuator Power</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-actuatorpower" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-manualoverride">Manual Override</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-manualoverride" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-status">Status</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-status" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="field-assessment-Actuation">Actuation</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input type="text" class="form-control form-control-sm" id="field-assessment-Actuation" readonly>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="assessment-content-card card-group-valveproperties last-in-group active">
                                            <div class="card-header">
                                                Assessment Information
                                            </div>
                                            <div class="card-content">
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="assessment-no">Assessment No</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input class="form-control form-control-sm" id="assessment-no" name="AssessmentNo" value="">
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="assessment-date">Assessment Date</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input class="form-control datepicker form-control-sm" id="assessment-date" name="AssessmentDate" value="@defaultDate" required>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-4">
                                                                <label class="col-form-label" for="time-period">Time Period (Month)</label>
                                                            </div>
                                                            <div class="col-8">
                                                                <input class="form-control form-control-sm calculate-assessment" id="time-period" name="timePeriode" type="number" step="1" onchange="calculateAssessment.apply(this)" value="12" required>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-8">
                                                                <label class="col-form-label" for="time-to-limit-a">Time to Limit State Leakage to atmosphere (Month)</label>
                                                            </div>
                                                            <div class="col-4">
                                                                <input class="form-control form-control-sm" id="time-to-limit-a" name="TimeToLimitStateLeakageToAtmosphere" value="0" type="number" step="1" required>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-8">
                                                                <label class="col-form-label" for="time-to-limit-b">Time to Limit State Failure of function (Month)</label>
                                                            </div>
                                                            <div class="col-4">
                                                                <input class="form-control form-control-sm" id="time-to-limit-b" name="TimeToLimitStateFailureOfFunction" value="0" type="number" step="1" required>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-8">
                                                                <label class="col-form-label" for="time-to-limit-c">Time to Limit State Passing accros valve (Month)</label>
                                                            </div>
                                                            <div class="col-4">
                                                                <input class="form-control form-control-sm" id="time-to-limit-c" name="TimeToLimitStatePassingAccrosValve" value="0" type="number" step="1" required>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="assessment-content-card card-group-inspectionhistory first-in-group last-in-group">
                                            <div class="card-header">
                                                Inspection History
                                            </div>
                                            <div class="card-content" style="min-height: 500px;">
                                                <input type="hidden" class="inspection-data-temp" id="inspectionDataTemp" name="inspectionDataTemp" />
                                                <a class="btn btn-primary btn-maincolor mb-2 mt-4 only-add" onclick="addInspection(this)">Add Inspection Data</a>
                                                <table class="datatable table custom-table inspection-table" style="width: 100%;">
                                                    <thead>
                                                        <tr>
                                                            <th>No</th>
                                                            <th>Inspection Date</th>
                                                            <th>Inspection Method</th>
                                                            <th>Inspection Description</th>
                                                            <th>Function Condition</th>
                                                            <th>Test Pressure  (if any)</th>
                                                            <th style="width:200px">Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="assessment-content-card card-group-maintenancehistory first-in-group last-in-group">
                                            <div class="card-header">
                                                Maintenance History
                                            </div>
                                            <div class="card-content" style="min-height: 500px;">
                                                <input type="hidden" class="maintenance-data-temp" id="maintenanceDataTemp" name="maintenanceDataTemp" />
                                                <a class="btn btn-primary btn-maincolor mb-2 mt-4 only-add" onclick="addMaintenance(this)">Add Maintenance Data</a>
                                                <table class="datatable table table-bordered maintenance-table" style="width:100%">
                                                    <thead>
                                                        <tr>
                                                            <th>No</th>
                                                            <th>Maintenance Date</th>
                                                            <th>Is Valve Repaired?</th>
                                                            <th>Maintenance Description</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="assessment-content-card card-group-riskassessment first-in-group">
                                            <div class="card-header">
                                                Likelihood of Failure
                                            </div>
                                            <div class="card-content">
                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-12">
                                                                LF1 - Current Condition
                                                            </div>
                                                            <span last-inspection-date id="last-inspection-date"></span>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-1">
                                                            </div>
                                                            <div class="col-5">
                                                                <label class="col-form-label" for="leakage-to-atmosphere">Leakage to atmophere</label>
                                                            </div>
                                                            <div class="col-6">
                                                                <select class="form-select form-select-sm calculate-assessment readonly" id="leakage-to-atmosphere" name="LeakageToAtmosphereID" onchange="calculateAssessment.apply(this)">
                                                                    @foreach (var item in limitState)
                                                                    {
                                                                        <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.CurrentConditionLimitState</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-1">
                                                            </div>
                                                            <div class="col-5">
                                                                <label class="col-form-label" for="failure-of-function">Failure of Function</label>
                                                            </div>
                                                            <div class="col-6">
                                                                <select class="form-select form-select-sm calculate-assessment readonly" id="failure-of-function" name="FailureOfFunctionID" onchange="calculateAssessment.apply(this)">
                                                                    @foreach (var item in limitState)
                                                                    {
                                                                        <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.CurrentConditionLimitState</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-1">
                                                            </div>
                                                            <div class="col-5">
                                                                <label class="col-form-label" for="passing-accross-valve">Passing accross valve</label>
                                                            </div>
                                                            <div class="col-6">
                                                                <select class="form-select form-select-sm calculate-assessment readonly" id="passing-accross-valve" name="PassingAccrosValveID" onchange="calculateAssessment.apply(this)">
                                                                    @foreach (var item in limitState)
                                                                    {
                                                                        <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.CurrentConditionLimitState</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field mt-2">
                                                            <div class="col-12">
                                                                LF2 - Time To Limit State
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-1">
                                                            </div>
                                                            <div class="col-4">
                                                            </div>
                                                            <div class="col-7">
                                                                <div class="row">
                                                                    <div class="col-4">
                                                                        <b>TP1</b>
                                                                    </div>
                                                                    <div class="col-4">
                                                                        <b>TP2</b>
                                                                    </div>
                                                                    <div class="col-4">
                                                                        <b>TP3</b>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-1">
                                                            </div>
                                                            <div class="col-4">
                                                                <label class="col-form-label">Leakage to atmophere</label>
                                                            </div>
                                                            <div class="col-7">
                                                                <div class="row">
                                                                    <div class="col-4">
                                                                        <select class="form-select form-select-sm calculate-assessment" id="leakage-tp1" name="LeakageToAtmosphereTP1ID" onchange="calculateAssessment.apply(this)">
                                                                            @foreach (var item in timeToLimitStates)
                                                                            {
                                                                                <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.TimeToLimitState</option>
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                    <div class="col-4">
                                                                        <select class="form-select form-select-sm calculate-assessment" id="leakage-tp2" name="LeakageToAtmosphereTP2ID" onchange="calculateAssessment.apply(this)">
                                                                            @foreach (var item in timeToLimitStates)
                                                                            {
                                                                                <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.TimeToLimitState</option>
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                    <div class="col-4">
                                                                        <select class="form-select form-select-sm calculate-assessment" id="leakage-tp3" name="LeakageToAtmosphereTP3ID" onchange="calculateAssessment.apply(this)">
                                                                            @foreach (var item in timeToLimitStates)
                                                                            {
                                                                                <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.TimeToLimitState</option>
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-1">
                                                            </div>
                                                            <div class="col-4">
                                                                <label class="col-form-label">Failure of Function</label>
                                                            </div>
                                                            <div class="col-7">
                                                                <div class="row">
                                                                    <div class="col-4">
                                                                        <select class="form-select form-select-sm calculate-assessment" id="failure-tp1" name="FailureOfFunctionTP1ID" onchange="calculateAssessment.apply(this)">
                                                                            @foreach (var item in timeToLimitStates)
                                                                            {
                                                                                <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.TimeToLimitState</option>
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                    <div class="col-4">
                                                                        <select class="form-select form-select-sm calculate-assessment" id="failure-tp2" name="FailureOfFunctionTP2ID" onchange="calculateAssessment.apply(this)">
                                                                            @foreach (var item in timeToLimitStates)
                                                                            {
                                                                                <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.TimeToLimitState</option>
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                    <div class="col-4">
                                                                        <select class="form-select form-select-sm calculate-assessment" id="failure-tp3" name="FailureOfFunctionTP3ID" onchange="calculateAssessment.apply(this)">
                                                                            @foreach (var item in timeToLimitStates)
                                                                            {
                                                                                <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.TimeToLimitState</option>
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-1">
                                                            </div>
                                                            <div class="col-4">
                                                                <label class="col-form-label">Passing accross valve</label>
                                                            </div>
                                                            <div class="col-7">
                                                                <div class="row">
                                                                    <div class="col-4">
                                                                        <select class="form-select form-select-sm calculate-assessment" id="passing-tp1" name="PassingAccrosValveTP1ID" onchange="calculateAssessment.apply(this)">
                                                                            @foreach (var item in timeToLimitStates)
                                                                            {
                                                                                <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.TimeToLimitState</option>
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                    <div class="col-4">
                                                                        <select class="form-select form-select-sm calculate-assessment" id="passing-tp2" name="PassingAccrosValveTP2ID" onchange="calculateAssessment.apply(this)">
                                                                            @foreach (var item in timeToLimitStates)
                                                                            {
                                                                                <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.TimeToLimitState</option>
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                    <div class="col-4">
                                                                        <select class="form-select form-select-sm calculate-assessment" id="passing-tp3" name="PassingAccrosValveTP3ID" onchange="calculateAssessment.apply(this)">
                                                                            @foreach (var item in timeToLimitStates)
                                                                            {
                                                                                <option value="@item.Id" attr-value="@item.LimitStateValue" attr-weighting="@item.Weighting">@item.TimeToLimitState</option>
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field mt-2">
                                                            <div class="col-6">
                                                                <label class="col-form-label" for="inspection-effectiveness">LF3 - Inspection Effectiveness</label>
                                                            </div>
                                                            <div class="col-6">
                                                                <select class="form-select form-select-sm calculate-assessment readonly" id="inspection-effectiveness" name="InspectionEffectivenessID" onchange="calculateAssessment.apply(this)">
                                                                    @foreach (var item in inspectionEffectivenessStates)
                                                                    {
                                                                        <option value="@item.Id" attr-value="@item.EffectivenessValue" attr-weighting="@item.Weighting">@item.Effectiveness</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-6">
                                                                <label class="col-form-label" for="impact-of-internal-fluid">LF4 - Impact of Internal Fluid Impurities</label>
                                                            </div>
                                                            <div class="col-6">
                                                                <select class="form-select form-select-sm calculate-assessment" id="impact-of-internal-fluid" name="ImpactOfInternalFluidImpuritiesID" onchange="calculateAssessment.apply(this)">
                                                                    @foreach (var item in impactEffectStates)
                                                                    {
                                                                        <option value="@item.Id" attr-value="@item.ImpactEffectValue" attr-weighting="@item.Weighting">@item.ImpactEffect</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-6">
                                                                <label class="col-form-label" for="impact-of-operating-envelopes">LF5 - Impact of Operating Envelopes</label>
                                                            </div>
                                                            <div class="col-6">
                                                                <select class="form-select form-select-sm calculate-assessment" id="impact-of-operating-envelopes" name="ImpactOfOperatingEnvelopesID" onchange="calculateAssessment.apply(this)">
                                                                    @foreach (var item in impactEffectStates)
                                                                    {
                                                                        <option value="@item.Id" attr-value="@item.ImpactEffectValue" attr-weighting="@item.Weighting2">@item.ImpactEffect</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-6">
                                                                <label class="col-form-label" for="used-within-oem-specification">LF6 - Used within OEM Specification</label>
                                                            </div>
                                                            <div class="col-6">
                                                                <select class="form-select form-select-sm calculate-assessment" id="used-within-oem-specification" name="UsedWithinOEMSpecificationID" onchange="calculateAssessment.apply(this)">
                                                                    @foreach (var item in usedWithinOEMSpecifications)
                                                                    {
                                                                        <option value="@item.Id" attr-value="@item.UsedWithinOEMSpecificationValue" attr-weighting="@item.Weighting">@item.UsedWithinOEMSpecification</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-6">
                                                                <label class="col-form-label" for="repaired">LF7 - Repaired</label>
                                                            </div>
                                                            <div class="col-6">
                                                                <select class="form-select form-select-sm calculate-assessment" id="repaired" name="RepairedID" onchange="calculateAssessment.apply(this)">
                                                                    @foreach (var item in repairedStates)
                                                                    {
                                                                        <option value="@item.Id" attr-value="@item.RepairedValue" attr-weighting="@item.Weighting">@item.Repaired</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="assessment-content-card card-group-riskassessment last-in-group">
                                            <div class="card-header">
                                                Consequence of Failure
                                            </div>
                                            <div class="card-content">
                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-6">
                                                                <label class="col-form-label" for="product-loss-definition">Product loss definition (bbls)</label>
                                                            </div>
                                                            <div class="col-6">
                                                                <input class="form-control form-control-sm bbls-assessment calculate-assessment" id="product-loss-definition" name="ProductLossDefinition" type="number" step="1" value="0" onchange="calculateAssessment.apply(this)" required>
                                                            </div>
                                                        </div>
                                                        <div class="row g-3 align-items-center single-field">
                                                            <div class="col-6">
                                                                <label class="col-form-label" for="hsse-definition">HSSE Definition</label>
                                                            </div>
                                                            <div class="col-6">
                                                                <select class="form-select form-select-sm" id="hsse-definition-bypld" hidden>
                                                                    @foreach (var item in hsseDefinisions)
                                                                    {
                                                                        <option value="@item.Id" attr-minvalue="@item.MinBBSValue" attr-cofcategory="@item.CoFCategory" attr-score="@item.Score">@item.HSSEDefinision</option>
                                                                    }
                                                                </select>
                                                                <select class="form-select form-select-sm" id="hsse-definition" name="HSSEDefinisionID">
                                                                    @foreach (var item in hsseDefinisions)
                                                                    {
                                                                        <option value="@item.Id" attr-minvalue="@item.MinBBSValue" attr-cofcategory="@item.CoFCategory" attr-score="@item.Score">@item.HSSEDefinision</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="assessment-content-card card-group-riskmatrix first-in-group last-in-group">
                                            <div class="card-header">
                                                Risk
                                            </div>
                                            @{
                                                bool devmode = false;
                                                string hidden_dev = devmode ? "" : "hidden";
                                            }
                                            <input type="hidden" name='ConsequenceOfFailure' id="consequenceOfFailure" />
                                            <input type="hidden" name='TP1A' id="TP1A-field" />
                                            <input type="hidden" name='TP2A' id="TP2A-field" />
                                            <input type="hidden" name='TP3A' id="TP3A-field" />
                                            <input type="hidden" name='TP1B' id="TP1B-field" />
                                            <input type="hidden" name='TP2B' id="TP2B-field" />
                                            <input type="hidden" name='TP3B' id="TP3B-field" />
                                            <input type="hidden" name='TP1C' id="TP1C-field" />
                                            <input type="hidden" name='TP2C' id="TP2C-field" />
                                            <input type="hidden" name='TP3C' id="TP3C-field" />
                                            <input type="hidden" name='TPTimeToActionA' id="TPA-TTA-field" />
                                            <input type="hidden" name='TPTimeToActionB' id="TPB-TTA-field" />
                                            <input type="hidden" name='TPTimeToActionC' id="TPC-TTA-field" />
                                            <input type="hidden" name='TP1Risk' id="TP1RISK-field" />
                                            <input type="hidden" name='TP2Risk' id="TP2RISK-field" />
                                            <input type="hidden" name='TP3Risk' id="TP3RISK-field" />
                                            <input type="hidden" name="TPTimeToActionRisk" id="TPRISK-TTA-field" />
                                            @{
                                                if(devmode){
                                                    <br/>
                                                    <b>LoFScoreLeakageToAtmophereTP1</b>
                                                }
                                            }
                                            <input class="col-md-3" type="@hidden_dev" name="LoFScoreLeakageToAtmophereTP1" id="TP1A-value" />
                                            @{
                                                if(devmode){
                                                    <br/>
                                                    <b>LoFScoreLeakageToAtmophereTP2</b>
                                                }
                                            }
                                            <input class="col-md-3" type="@hidden_dev" name="LoFScoreLeakageToAtmophereTP2" id="TP2A-value" />
                                            @{
                                                if(devmode){
                                                    <br/>
                                                    <b>LoFScoreLeakageToAtmophereTP3</b>
                                                }
                                            }
                                            <input class="col-md-3" type="@hidden_dev" name="LoFScoreLeakageToAtmophereTP3" id="TP3A-value" />
                                            @{
                                                if(devmode){
                                                    <br/>
                                                    <b>LoFScoreFailureOfFunctionTP1</b>
                                                }
                                            }
                                            <input class="col-md-3" type="@hidden_dev" name="LoFScoreFailureOfFunctionTP1" id="TP1B-value" />
                                            @{
                                                if(devmode){
                                                    <br/>
                                                    <b>LoFScoreFailureOfFunctionTP2</b>
                                                }
                                            }
                                            <input class="col-md-3" type="@hidden_dev" name="LoFScoreFailureOfFunctionTP2" id="TP2B-value" />
                                            @{
                                                if(devmode){
                                                    <br/>
                                                    <b>LoFScoreFailureOfFunctionTP3</b>
                                                }
                                            }
                                            <input class="col-md-3" type="@hidden_dev" name="LoFScoreFailureOfFunctionTP3" id="TP3B-value" />
                                            @{
                                                if(devmode){
                                                    <br/>
                                                    <b>LoFScorePassingAccrossValveTP1</b>
                                                }
                                            }
                                            <input class="col-md-3" type="@hidden_dev" name="LoFScorePassingAccrossValveTP1" id="TP1C-value" />
                                            @{
                                                if(devmode){
                                                    <br/>
                                                    <b>LoFScorePassingAccrossValveTP2</b>
                                                }
                                            }
                                            <input class="col-md-3" type="@hidden_dev" name="LoFScorePassingAccrossValveTP2" id="TP2C-value" />
                                            @{
                                                if(devmode){
                                                    <br/>
                                                    <b>LoFScorePassingAccrossValveTP3</b>
                                                }
                                            }
                                            <input class="col-md-3" type="@hidden_dev" name="LoFScorePassingAccrossValveTP3" id="TP3C-value" />
                                            @{
                                                if(devmode){
                                                    <br/>
                                                    <b>CoFScore</b>
                                                }
                                            }
                                            <input class="col-md-3" type="@hidden_dev" name="CoFScore" id="COF-value" />

                                            <div class="card-content">
                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <div class="row g-3 mb-4 mt-1">
                                                            <div class="col-12 d-flex">
                                                                <div class="risk-table-container">
                                                                    <svg class="risk-table-legend" viewBox="0 0 550 440">
                                                                        <defs>
                                                                            <path d="M 0 0  L 550 0  L 550 440  L 0 440  Z " fill-rule="evenodd" fill="black" id="path33" />
                                                                            <clipPath id="clip34">
                                                                                <use xlink:href="#path33" />
                                                                            </clipPath>
                                                                            <filter x="-50.00%" y="-50.00%" width="200.00%" height="200.00%" filterUnits="objectBoundingBox" id="filter35">
                                                                                <feColorMatrix type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0  " in="SourceGraphic" />
                                                                            </filter>
                                                                        </defs>
                                                                        <g transform="matrix(1 0 0 1 -174 -55 )">
                                                                            <g transform="matrix(0.902272727272727 0 0 0.902272727272727 200.875 55 )" clip-path="url(#clip34)" filter="url(#filter35)">
                                                                                <text x="125" y="275" font-size="12">A</text>
                                                                                <text x="125" y="225" font-size="12">B</text>
                                                                                <text x="125" y="175" font-size="12">C</text>
                                                                                <text x="125" y="125" font-size="12">D</text>
                                                                                <text x="125" y="75" font-size="12">E</text>
                                                                                <text x="175" y="322" font-size="12">1</text>
                                                                                <text x="225" y="322" font-size="12">2</text>
                                                                                <text x="275" y="322" font-size="12">3</text>
                                                                                <text x="325" y="322" font-size="12">4</text>
                                                                                <text x="375" y="322" font-size="12">5</text>
                                                                                <text x="225" y="350" font-size="12" font-weight="bold">Likelihood of Failure</text>
                                                                                <g transform="translate(100,242)">
                                                                                    <g transform="rotate(-90)">
                                                                                        <text font-size="12" font-weight="bold">Consequence of Failure</text>
                                                                                    </g>
                                                                                </g>
                                                                                <g class="legend">
                                                                                    <polygon points="425,55 420,65 430,65" fill="white" stroke-width="2" stroke="gray"></polygon>
                                                                                    <text x="440" y="65" font-size="12">TP1 A</text>
                                                                                    <circle cx="425" cy="78" r="5" fill="white" stroke-width="2" stroke="gray"></circle>
                                                                                    <text x="440" y="83" font-size="12">TP2 A</text>
                                                                                    <rect x="420" y="91" width="10" height="10" fill="white" stroke-width="2" stroke="gray"></rect>
                                                                                    <text x="440" y="101" font-size="12">TP3 A</text>
                                                                                    <polygon points="425,110 420,120 430,120" fill="black" stroke-width="2" stroke="gray"></polygon>
                                                                                    <text x="440" y="120" font-size="12">TP1 B</text>
                                                                                    <circle cx="425" cy="134" r="5" fill="black" stroke-width="2" stroke="gray"></circle>
                                                                                    <text x="440" y="139" font-size="12">TP2 B</text>
                                                                                    <rect x="420" y="148" width="10" height="10" fill="black" stroke-width="2" stroke="gray"></rect>
                                                                                    <text x="440" y="158" font-size="12">TP3 B</text>
                                                                                    <polygon points="425,167 420,177 430,177" fill="pink" stroke-width="2" stroke="gray"></polygon>
                                                                                    <text x="440" y="177" font-size="12">TP1 C</text>
                                                                                    <circle cx="425" cy="191" r="5" fill="pink" stroke-width="2" stroke="gray"></circle>
                                                                                    <text x="440" y="196" font-size="12">TP2 C</text>
                                                                                    <rect x="420" y="205" width="10" height="10" fill="pink" stroke-width="2" stroke="gray"></rect>
                                                                                    <text x="440" y="215" font-size="12">TP3 C</text>
                                                                                </g>
                                                                            </g>
                                                                        </g>
                                                                    </svg>
                                                                    <div class="risk-matrix">
                                                                        <div class="risk-matrix-dots">
                                                                            <!-- A Leakage to Atmosphere -->
                                                                            <div class="dot dot-tp1 type-a" id="TP1A"></div>
                                                                            <div class="dot dot-tp2 type-a" id="TP2A"></div>
                                                                            <div class="dot dot-tp3 type-a" id="TP3A"></div>
                                                                            <!-- B Failure -->
                                                                            <div class="dot dot-tp1 type-b" id="TP1B"></div>
                                                                            <div class="dot dot-tp2 type-b" id="TP2B"></div>
                                                                            <div class="dot dot-tp3 type-b" id="TP3B"></div>
                                                                            <!-- C Passing Accross Valve -->
                                                                            <div class="dot dot-tp1 type-c" id="TP1C"></div>
                                                                            <div class="dot dot-tp2 type-c" id="TP2C"></div>
                                                                            <div class="dot dot-tp3 type-c" id="TP3C"></div>
                                                                        </div>
                                                                        <svg id="risk-table" width="250" height="250">
                                                                            <g>
                                                                                <g>
                                                                                    <rect x="0" y="200" width="50" height="50" fill="#81B014" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="50" y="200" width="50" height="50" fill="#81B014" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="100" y="200" width="50" height="50" fill="#008001" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="150" y="200" width="50" height="50" fill="#FFFF00" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="200" y="200" width="50" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                    <rect x="200" y="200" width="1" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="5"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="0" y="150" width="50" height="50" fill="#6FA529" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="50" y="150" width="50" height="50" fill="#008001" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="100" y="150" width="50" height="50" fill="#FFFF00" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="150" y="150" width="50" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                    <rect x="150" y="150" width="1" height="50" fill="#FFFF00" stroke="rgb(0,0,0)" stroke-width="5"></rect>
                                                                                    <rect x="150" y="200" width="50" height="1" fill="#FFFF00" stroke="rgb(0,0,0)" stroke-width="5"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="200" y="150" width="50" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="0" y="100" width="50" height="50" fill="#008001" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="50" y="100" width="50" height="50" fill="#FFFF00" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="100" y="100" width="50" height="50" fill="#FFFF00" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="150" y="100" width="50" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                    <rect x="150" y="100" width="1" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="5"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="200" y="100" width="50" height="50" fill="#FE0000" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="0" y="50" width="50" height="50" fill="#FFFF00" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="50" y="50" width="50" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                    <rect x="50" y="50" width="1" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="5"></rect>
                                                                                    <rect x="50" y="100" width="50" height="1" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="5"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="100" y="50" width="50" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                    <rect x="100" y="100" width="50" height="1" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="5"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="150" y="50" width="50" height="50" fill="#FE0000" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="200" y="50" width="50" height="50" fill="#FE0000" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="0" y="0" width="50" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="50" y="0" width="50" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                    <rect x="50" y="0" width="1" height="50" fill="#FF6400" stroke="rgb(0,0,0)" stroke-width="5"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="100" y="0" width="50" height="50" fill="#FE0000" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="150" y="0" width="50" height="50" fill="#FE0000" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                                <g>
                                                                                    <rect x="200" y="0" width="50" height="50" fill="#FE0000" stroke="rgb(0,0,0)" stroke-width="1"></rect>
                                                                                </g>
                                                                            </g>
                                                                        </svg>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        @* <div class="row g-3 align-items-center single-field">
                                                            <div class="col-3">
                                                                <label class="col-form-label">Limit State</label>
                                                            </div>
                                                            <div class="col-4">
                                                                <select class="form-select form-select-sm">
                                                                    <option>All</option>
                                                                    <option>Leakage to atmosphere</option>
                                                                    <option>Failure of Function</option>
                                                                    <option>Passing Across Valve</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-4">
                                                                <select class="form-select form-select-sm">
                                                                    <option>All</option>
                                                                    <option>TP1</option>
                                                                    <option>TP2</option>
                                                                    <option>TP3</option>
                                                                </select>
                                                            </div>
                                                        </div> *@
                                                        <div class="row g-3">
                                                            <div class="col-12">
                                                                <table id="example" class="table table-hover custom-table basic-th mt-4" style="width:100%">
                                                                    <tbody>
                                                                        <tr>
                                                                            <td class="ta-center header-cell">Limit State</td>
                                                                            <td class="ta-center header-cell">Risk TP1</td>
                                                                            <td class="ta-center header-cell">Risk TP2</td>
                                                                            <td class="ta-center header-cell">Risk TP3</td>
                                                                            <td class="ta-center header-cell">Time To Action</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td class="header-cell">Leakage Atmosphere</td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP1A-colorlabel id="TP1A-colorlabel"></div>
                                                                                    <span TP1A-label id="TP1A-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP2A-colorlabel id="TP2A-colorlabel"></div>
                                                                                    <span TP2A-label id="TP2A-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP3A-colorlabel id="TP3A-colorlabel"></div>
                                                                                    <span TP3A-label id="TP3A-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <span TPA-TTA id="TPA-TTA"></span>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td class="header-cell">Failure of function</td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP1B-colorlabel id="TP1B-colorlabel"></div>
                                                                                    <span TP1B-label id="TP1B-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP2B-colorlabel id="TP2B-colorlabel"></div>
                                                                                    <span TP2B-label id="TP2B-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP3B-colorlabel id="TP3B-colorlabel"></div>
                                                                                    <span TP3B-label id="TP3B-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <span TPB-TTA id="TPB-TTA"></span>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td class="header-cell">Passing across valve</td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP1C-colorlabel id="TP1C-colorlabel"></div>
                                                                                    <span TP1C-label id="TP1C-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP2C-colorlabel id="TP2C-colorlabel"></div>
                                                                                    <span TP2C-label id="TP2C-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP3C-colorlabel id="TP3C-colorlabel"></div>
                                                                                    <span TP3C-label id="TP3C-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <span TPC-TTA id="TPC-TTA"></span>
                                                                            </td>
                                                                        </tr>
                                                                    <tfoot class="bg-grey">
                                                                        <tr>
                                                                            <td class="header-cell">Risk</td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP1RISK-colorlabel id="TP1RISK-colorlabel"></div>
                                                                                    <span TP1RISK-label id="TP1RISK-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP2RISK-colorlabel id="TP2RISK-colorlabel"></div>
                                                                                    <span TP2RISK-label id="TP2RISK-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="d-flex">
                                                                                    <div TP3RISK-colorlabel id="TP3RISK-colorlabel"></div>
                                                                                    <span TP3RISK-label id="TP3RISK-label"></span>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <span TPRISK-TTA id="TPRISK-TTA"></span>
                                                                            </td>
                                                                        </tr>
                                                                    </tfoot>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="assessment-content-card card-group-integrityplan  first-in-group last-in-group">
                                            <div class="card-header">
                                                Integrity Plan
                                            </div>
                                            <div class="card-content">
                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <div class="row g-3">
                                                            <div class="col-6">
                                                                <div class="mb-3">
                                                                    <label class="form-label fw-500">Integrity Status</label>                                  
                                                                    <div class="input-group input-group-sm input-search">
                                                                        @* <span class="input-group-text disabled">
                                                                            <div class="status-box green">
                                                                            </div>
                                                                        </span> *@
                                                                        <select id="integrity-status" class="form-select form-select-sm" name="IntegrityStatus">
                                                                            <option value="1">Very High Priority</option>
                                                                            <option value="2">High Priority</option>
                                                                            <option value="3">Medium Priority</option>
                                                                            <option value="4">Low Priority</option>
                                                                            <option value="5">Very Low Priority</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label class="form-label fw-500" for="assessment-summary">Summary</label>
                                                                    <textarea class="form-control form-control-sm" id="assessment-summary" style="height: 200px;" name="Summary"></textarea>
                                                                </div>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="mb-3">
                                                                    <label class="form-label fw-500">Time To Action</label>
                                                                    <input id="time-to-action" class="form-control datepicker form-control-sm" name="TimeToAction" required/>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label class="form-label fw-500" for="recommended-action">Recommendation Action</label>
                                                                    <select class="form-select form-select-sm" id="recommended-action" name="RecommendationActionID">
                                                                        <option value="1">Inspection</option>
                                                                        <option value="2">Repair</option>
                                                                        <option value="3">Replace</option>
                                                                    </select>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label class="form-label fw-500" for="detailed-recommendation">Detailed Recommendation</label>
                                                                    <textarea class="form-control form-control-sm" style="height: 124px;" id="detailed-recommendation" name="DetailedRecommendation"></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div class="modal fade modal-xl assessment-form-modal" id="detailInspectionModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <form class="inspection-form inspection-tab">
                    <div class="box">
                        <div class="subheader m-0">
                            <b>Asset Information</b>
                        </div>
                        <div class="sub-container">
                            <div class="form-container">
                                <div class="form-grid">
                                    <div class="form-group-inline">
                                        <label for="field-inspection-assetid">Asset ID</label>
                                        <input type="text" class="form-control" id="field-inspection-assetid" readonly name="AssetID">
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="field-inspection-valvetype">Valve Type</label>
                                        <input type="text" class="form-control" id="field-inspection-valvetype" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="field-inspection-tagno">Tag No</label>
                                        <input type="text" class="form-control" id="field-inspection-tagno" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="field-inspection-manufacturer">Manufacturer</label>
                                        <input type="text" class="form-control" id="field-inspection-manufacturer" readonly>
                                    </div>
                                    <div class="form-group-inline" style="display: none;">
                                        <label for="field-inspection-equipmentname">Equipment Name</label>
                                        <input type="text" class="form-control" id="field-inspection-equipmentname" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="field-inspection-bodymaterial">Body Material</label>
                                        <input type="text" class="form-control" id="field-inspection-bodymaterial" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="businessarea">Business Area</label>
                                        <input type="text" class="form-control" id="businessarea" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="bodymodel">Body Model</label>
                                        <input type="text" class="form-control" id="bodymodel" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="platform">Platform</label>
                                        <input type="text" class="form-control" id="platform" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="endconnection">End Connection</label>
                                        <input type="text" class="form-control" id="endconnection" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="parentequipmentno">Parent Equipment No.</label>
                                        <input type="text" class="form-control" id="parentequipmentno" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="serialno">Serial No.</label>
                                        <input type="text" class="form-control" id="serialno" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="parentequipmentdescription">Parent Equipment Description</label>
                                        <input type="text" class="form-control" id="parentequipmentdescription" readonly>
                                    </div>
                                    <div class="form-group-inline" style="display: none;">
                                        <label for="usagetype">Usage Type</label>
                                        <input type="text" class="form-control" id="usagetype" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="installationdate">Installation Date</label>
                                        <input type="text" class="form-control" id="installationdate" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="size">Size (inch)</label>
                                        <input type="text" class="form-control" id="size" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="pidno">PID No</label>
                                        <input type="text" class="form-control" id="pidno" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="classrating">Class Rating</label>
                                        <input type="text" class="form-control" id="classrating" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box">
                        <div class="subheader m-0">
                            <b>Inspection Information</b>
                        </div>
                        <div class="sub-container">
                            <div class="form-container">
                                <div class="form-grid">
                                    <input type="hidden" name="Id" id="data-id">
                                    <div class="form-group ">
                                        <label for="field-inspection-valvetagno">Valve Tag No</label>
                                        <input type="text" class="form-control" id="field-inspection-valvetagno" readonly>
                                    </div>
                                    <div class="form-group ">
                                        <label for="field-inspection-current-condition-limit-state-a">Current Condition Leakage to Atmosphere</label>
                                        <select class="form-control"
                                            id="field-inspection-current-condition-limit-state-a"
                                            name="CurrentConditionLeakeageToAtmosphereID"
                                        >
                                            @foreach (var item in limitState)
                                        {
                                                    <option value="@item.Id">@item.CurrentConditionLimitState</option>
                                        }
                                        </select>
                                    </div>
                                    <div class="form-group ">
                                        <label for="field-inspection-date">Inspection Date</label>
                                        <input id="field-inspection-date" type="text"
                                            class="form-control datepicker" name="InspectionDate"/>
                                    </div>
                                    <div class="form-group ">
                                        <label for="field-inspection-current-condition-limit-state-b">Current Condition Failure of Function</label>
                                        <select class="form-control"
                                            id="field-inspection-current-condition-limit-state-b"
                                            name="CurrentConditionFailureOfFunctionID"
                                        >
                                        @foreach (var item in limitState)
                                        {
                                                    <option value="@item.Id">@item.CurrentConditionLimitState</option>
                                        }
                                        </select>
                                    </div>
                                    <div class="form-group ">
                                        <label for="field-inspection-inspection-method">Inspection
                                            Method</label>
                                        <select class="form-control" id="field-inspection-inspection-method" name="InspectionMethodID">
                                        @foreach (var item in inspectionMethods)
                                        {
                                                    <option value="@item.Id">@item.InspectionMethod</option>
                                        }
                                        </select>
                                    @* <input type="text" class="form-control"
                                        id="field-inspection-inspection-method" value="Visual Inspection"> *@
                                    </div>
                                    <div class="form-group ">
                                        <label for="field-inspection-current-condition-limit-state-c">Current
                                            Condition Passing Across Valve</label>
                                        <select class="form-control"
                                            id="field-inspection-current-condition-limit-state-c"
                                            name="CurrentConditionPassingAcrossValveID"
                                        >
                                        @foreach (var item in limitState)
                                        {
                                                    <option value="@item.Id">@item.CurrentConditionLimitState</option>
                                        }
                                        </select>
                                    </div>
                                    <div class="form-group ">
                                        <label for="field-inspection-effectiveness">Inspection
                                            Effectiveness</label>
                                        <select class="form-control" id="field-inspection-effectiveness" name="InspectionEffectivenessID">
                                        @foreach (var item in inspectionEffectivenessStates)
                                        {
                                                    <option value="@item.Id">@item.Effectiveness</option>
                                        }
                                        </select>
                                    </div>
                                    <div class="form-group ">
                                        <label for="field-inspection-function-condition">Function
                                            Condition</label>
                                        <input type="text" class="form-control"
                                            id="field-inspection-function-condition"
                                            name="FunctionCondition"
                                        >
                                    </div>
                                    <div class="form-group">
                                        <label for="field-inspection-description">Inspection Description</label>
                                        <textarea class="form-control" id="field-inspection-description"
                                            rows="12" name="InspectionDescription"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="form-group col-md-12 mb-2">
                                                <label for="field-inspection-test-pressure-if-any">Test Pressure
                                                    if Any</label>
                                                <input type="text" 
                                                    name="TestPressureIfAny"
                                                    class="form-control"
                                                    id="field-inspection-test-pressure-if-any">
                                            </div>
                                            <div class="col-md-12">
                                                <label for="field-inspection-image">Inspection Image</label>
                                                <div class="gallery-input">
                                                    <!-- <input type="file" class="form-control image-gallery-upload" id="field-inspection-image" onchange="imagesPreview(this)" multiple>
                                                    <div class="preview-image-gallery">
                                                        <label class="add-image" for="field-inspection-image"><i class="fa-solid fa-file-circle-plus"></i></label>
                                                    </div> -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="box-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade modal-xl assessment-form-modal" id="detailMaintenanceModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <form class="inspection-form inspection-tab">
                    <div class="box">
                        <div class="subheader m-0">
                            <b>Asset Information</b>
                        </div>
                        <div class="sub-container">
                            <div class="form-container">
                                <div class="form-grid">
                                    <div class="form-group-inline">
                                        <label for="field-inspection-assetid">Asset ID</label>
                                        <input type="text" class="form-control" id="field-inspection-assetid" name="AssetID" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="field-inspection-valvetype">Valve Type</label>
                                        <input type="text" class="form-control" id="field-inspection-valvetype" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="field-inspection-tagno">Tag No</label>
                                        <input type="text" class="form-control" id="field-inspection-tagno" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="field-inspection-manufacturer">Manufacturer</label>
                                        <input type="text" class="form-control" id="field-inspection-manufacturer" readonly>
                                    </div>
                                    <div class="form-group-inline" style="display: none;">
                                        <label for="field-inspection-equipmentname">Equipment Name</label>
                                        <input type="text" class="form-control" id="field-inspection-equipmentname" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="field-inspection-bodymaterial">Body Material</label>
                                        <input type="text" class="form-control" id="field-inspection-bodymaterial" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="businessarea">Business Area</label>
                                        <input type="text" class="form-control" id="businessarea" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="bodymodel">Body Model</label>
                                        <input type="text" class="form-control" id="bodymodel" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="platform">Platform</label>
                                        <input type="text" class="form-control" id="platform" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="endconnection">End Connection</label>
                                        <input type="text" class="form-control" id="endconnection" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="parentequipmentno">Parent Equipment No.</label>
                                        <input type="text" class="form-control" id="parentequipmentno" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="serialno">Serial No.</label>
                                        <input type="text" class="form-control" id="serialno" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="parentequipmentdescription">Parent Equipment Description</label>
                                        <input type="text" class="form-control" id="parentequipmentdescription" readonly>
                                    </div>
                                    <div class="form-group-inline" style="display: none;">
                                        <label for="usagetype">Usage Type</label>
                                        <input type="text" class="form-control" id="usagetype" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="installationdate">Installation Date</label>
                                        <input type="text" class="form-control" id="installationdate" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="size">Size (inch)</label>
                                        <input type="text" class="form-control" id="size" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="pidno">PID No</label>
                                        <input type="text" class="form-control" id="pidno" readonly>
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="classrating">Class Rating</label>
                                        <input type="text" class="form-control" id="classrating" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box">
                        <div class="subheader m-0">
                            <b>Maintenance Information</b>
                        </div>
                        <div class="sub-container">
                            <div class="form-container">
                                <div class="form-grid">
                                    <input type="hidden" name="Id" id="data-id">
                                    <div class="form-group ">
                                        <label for="field-maintenance-date">Maintenance Date</label>
                                        <input id="field-maintenance-date" type="text"
                                            class="form-control datepicker" name="MaintenanceDate"/>
                                    </div>
                                    <div class="form-group ">
                                        <label for="field-maintenance-repaired">Is Valve Repaired</label>
                                        <select class="form-control"
                                            id="field-maintenance-repaired"
                                            name="IsValveRepairedID"
                                        >
                                            <option value="1">Yes</option>
                                            <option value="2">No</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="field-maintenance-description">Maintenance Description</label>
                                        <textarea class="form-control" id="field-maintenance-description"
                                            rows="8"
                                            name="MaintenanceDescription"
                                            ></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="field-maintenance-image">Maintenance Image</label>
                                        <div class="gallery-input">
                                            <!-- <input type="file" class="form-control image-gallery-upload" id="field-maintenance-image" onchange="imagesPreview(this)" multiple>
                                            <div class="preview-image-gallery">
                                                <label class="add-image" for="field-maintenance-image"><i class="fa-solid fa-file-circle-plus"></i></label>
                                            </div> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="box-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade modal-xl assessment-form-modal" id="addInspectionModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <form class="inspection-form inspection-tab">
                    <input type="hidden" name="tempData" />
                    <input type="hidden" name="tabNum" />
                    <div class="sub-container">
                        <table class="datatable table custom-table inspection-table" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Inspection Date</th>
                                    <th>Inspection Method</th>
                                    <th>Inspection Description</th>
                                    <th>Function Condition</th>
                                    <th>Test Pressure  (if any)</th>
                                    <th style="width:200px">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <div class="box">
                            <div class="box-footer">
                                <button type="button" class="btn btn-secondary" onclick="confirmInspection(this)">Confirm</button>
                                <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade modal-xl assessment-form-modal" id="addMaintenanceModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <form class="inspection-form inspection-tab">
                    <input type="hidden" name="tempData" />
                    <input type="hidden" name="tabNum" />
                    <div class="sub-container">
                        <table class="datatable table custom-table maintenance-table" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Maintenance Date</th>
                                    <th>Is Valve Repaired?</th>
                                    <th>Maintenance Description</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <div class="box">
                            <div class="box-footer">
                                <button type="button" class="btn btn-secondary" onclick="confirmMaintenance(this)">Confirm</button>
                                <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

@section Scripts {
        <script>
            const urlParams = new URLSearchParams(window.location.search);
            const idParam = Number(urlParams.get('assessmentid'));
            const assetIdParam = Number(urlParams.get('assetid'));
            $(document).ready(function () {
                $('.btn-add-new-inspection').click(addTab);
                if(idParam) {
                    $('.btn-add-new-inspection[attr-inspection-id='+idParam+']').trigger('click')
                } else if(assetIdParam) {
                    $('.btn-add-new-inspection[attr-id=' + assetIdParam + ']').first().trigger('click')
                }
                // development purpose
                @* $('.btn-add-new-inspection').eq(0).trigger('click') *@

                @* $('.bbls-assessment').on('change', function () {
                    if($(this).val() < 0 || $(this).val() == ''){
                        $(this).val(0);
                    }
                    var ctr = $(this).closest('.tab-pane').attr('tab-num');
                    var bbls = $(this).val()*1;
                    var hsseSelect = $('#hsse-definition' + ctr);
                    var hsseOptions = hsseSelect.find('option');
                    var selectedHsse = '';
                    hsseOptions.each(function(){
                        var hsseValue = $(this).attr('attr-minvalue')*1;
                        if(bbls >= hsseValue){
                            selectedHsse = $(this).val();
                        }
                    });
                    hsseSelect.val(selectedHsse);
                }) *@
            });

            const assessmentCalculatedField = [
                'consequenceOfFailure',
                'tP1A',
                'tP2A',
                'tP3A',
                'tP1B',
                'tP2B',
                'tP3B',
                'tP1C',
                'tP2C',
                'tP3C',
                'tpTimeToActionA',
                'tpTimeToActionB',
                'tpTimeToActionC',
            ]

            var gLastInspectionDate = null;

            $(document).on('click', '.btn-close-inspection', function () {
                const ctr = $(this).closest('a').attr('tab-num')
                close_inspection(ctr);
            })

            function submitForm(el) {
                const form = $(el).closest('form.assessment-form')
                const equipmentId = $(el).closest('.tab-pane').attr('equipment-id')
                const ctr = $(el).closest('.tab-pane').attr('tab-num')
                const nativeForm = form[0]
                const formData = new FormData(nativeForm);
                const selectedInspectionCount = form.find('input[name=selectedInspectionId]').length
                const selectedMaintenanceCount = form.find('input[name=selectedMaintenanceId]').length
                if(!selectedInspectionCount || !selectedMaintenanceCount) {
                    alert('please input at least one inspection and one maintenance')
                    return
                }
                if(form.valid()) {
                    if(form.hasClass('history-form')) {
                        // update
                        $.ajax({
                            url: '@urlassessmentupdate',
                            type: 'POST', // or 'GET' depending on your form method
                            data: formData,
                            contentType: false,
                            processData: false,
                            success: function(res) {
                                // Handle success response
                                alert('Data successfully updated')
                                fetchHistoryData({
                                    id: res.id,
                                    counter: ctr
                                })
                            },
                            error: function(xhr, status, error) {
                                alert('Error submitting the form')
                            }
                        });
                    } else {
                        // add new
                        $.ajax({
                            url: '@urlassessmentadd',
                            type: 'POST', // or 'GET' depending on your form method
                            data: formData,
                            contentType: false,
                            processData: false,
                            success: function(res) {
                                form.addClass('history-form')
                                // add menu to tree
                                $('ul[equipment-id="'+equipmentId+'"]').append(`
                                    <li class="treeview">
                                        <a class="btn-add-new-inspection" history-button="" 
                                        attr-id="${res.asset.id}" attr-inspection-id="${res.id}" 
                                        attr-name="${res.assessmentNo}" 
                                        attr-sidebar-level="4" 
                                        attr-find-inspection="${res.asset.businessArea}" 
                                        attr-find-platform="${res.asset.platform}" 
                                        attr-find-equipment="${res.asset.tagNo}" 
                                        attr-find-imr="NEW"
                                        onclick="addTab.apply(this)"
                                        >
                                            ${res.assessmentNo}
                                        </a>
                                    </li>
                                `)
                                $('.nav-tab-menus').find('a[tab-num='+ctr+'] div[tab-title]').text(res.asset.tagNo + ' ' + res.assessmentNo)

                                fetchHistoryData({
                                    id: res.id,
                                    counter: ctr
                                })
                                alert('Data successfully inserted')
                            },
                            error: function(xhr, status, error) {
                                // Handle error
                                alert('An assessment with the same asset and date already exists')
                            }
                        });
                    }
                } else {
                    alert('please check the required fields')
                }
            }

            function deleteForm(el) {
                const form = $(el).closest('form.assessment-form')

                const id = form.find('#data-id').val()
                const tabId = $(el).closest('.tab-pane').attr('id')
                const ctr = $(el).closest('.tab-pane').attr('tab-num')

                if(confirm('Are you sure you want to delete this data?')) {
                    $.ajax({
                        url: '@urlassessmentdelete',
                        type: 'POST', // or 'GET' depending on your form method
                        data: {
                            Id: id
                        },
                        success: function(response) {
                            close_inspection(ctr, true)
                            alert('Data successfully deleted')
                            $('.btn-add-new-inspection[attr-inspection-id='+id+']').closest('li').remove()
                            // Handle success response
                        },
                        error: function(xhr, status, error) {
                            alert('Error deleting data')
                        }
                    });
                }
            }

            function fetchAssetData ({id, counter}) {
                $.ajax({
                    url: '@urlassetdetail',
                    type: 'GET',
                    data: { id },
                    success: function (data) {
                        fillAssetInfo ({counter, data})
                    },
                    error: function (error) {
                        alert('Valve Tag not found');
                        $('#inspectionheader' + counter).remove();
                        $('#inspection' + counter).remove();
                        moveToLastTab()
                    }
                });
            }

            function fetchHistoryData ({id, counter}) {
                $.ajax({
                    url: '@urlassessmentdetail',
                    type: 'GET',
                    data: { id },
                    success: function (data) {
                        // $('#field-inspection-valvetagno' + counter).val(data.tagNo);
                        fillAssetInfo({
                            counter, data: data.asset
                        })

                        if(data.inspectionHistory.length > 0) {
                            fillInspectionTable(counter, data.inspectionHistory)
                        }
                        if(data.maintenanceHistory.length > 0) {
                            fillMaintenanceTable(counter, data.maintenanceHistory)
                        }

                        // check if field editable
                        const editable = assessmentCalculatedField.some(field => data[field] === null)
                        if(!editable) {
                            $('#inspection'+counter).find('input:not([type="hidden"]), textarea, select').attr('disabled', true)
                            $('#inspection'+counter).find('.print-button').attr('href', '@urlassessmentprint'+'/'+id)
                            $('#inspection'+counter+' .assessment-form').addClass('not-editable')
                            $('.only-add').hide()
                        }

                        // fill history data
                        $('#field-inspection-date'+counter).val(data.inspectionDate)
                        $('#field-inspection-inspection-method'+counter).val(data.inspectionMethodID)
                        $('#field-inspection-current-condition-limit-state-a'+counter).val(data.currentConditionLeakeageToAtmosphereID)
                        $('#field-inspection-current-condition-limit-state-b'+counter).val(data.currentConditionFailureOfFunctionID)
                        $('#field-inspection-current-condition-limit-state-c'+counter).val(data.currentConditionPassingAcrossValveID)
                        $('#field-inspection-effectiveness'+counter).val(data.inspectionEffectivenessID)
                        $('#field-inspection-function-condition'+counter).val(data.functionCondition)
                        $('#field-inspection-description'+counter).val(data.inspectionDescription)
                        $('#field-inspection-test-pressure-if-any'+counter).val(data.testPressureIfAny)

                        //fill assessment data
                        $('#assessment-no'+counter).val(data.assessmentNo)
                        $('#assessment-date'+counter).val(data.assessmentDate)
                        $('#time-period'+counter).val(data.timePeriode)
                        $('#time-to-limit-a'+counter).val(data.timeToLimitStateLeakageToAtmosphere)
                        $('#time-to-limit-b'+counter).val(data.timeToLimitStateFailureOfFunction)
                        $('#time-to-limit-c'+counter).val(data.timeToLimitStatePassingAccrosValve)
                        $('#inspection-effectiveness'+counter).val(data.inspectionEffectivenessID)
                        $('#impact-of-internal-fluid'+counter).val(data.impactOfInternalFluidImpuritiesID)
                        $('#impact-of-operating-envelopes'+counter).val(data.impactOfOperatingEnvelopesID)
                        $('#used-within-oem-specification'+counter).val(data.usedWithinOEMSpecificationID)
                        $('#repaired'+counter).val(data.repairedID)
                        $('#product-loss-definition'+counter).val(data.productLossDefinition)
                        $('#hsse-definition'+counter).val(data.hsseDefinisionID)
                        $('#assessment-summary'+counter).val(data.summary)
                        $('#recommended-action'+counter).val(data.recommendationActionID)
                        $('#detailed-recommendation'+counter).val(data.detailedRecommendation)

                        //LF1 & LF2
                        $('#lastInspectionDate'+counter).val(data.inspectionDate)
                        $('#leakage-to-atmosphere'+counter).val(data.leakageToAtmosphereID)
                        $('#failure-of-function'+counter).val(data.failureOfFunctionID)
                        $('#passing-accross-valve'+counter).val(data.passingAccrosValveID)

                        $('#leakage-tp1'+counter).val(data.leakageToAtmosphereTP1ID)
                        $('#leakage-tp2'+counter).val(data.leakageToAtmosphereTP2ID)
                        $('#leakage-tp3'+counter).val(data.leakageToAtmosphereTP3ID)

                        $('#failure-tp1'+counter).val(data.failureOfFunctionTP1ID)
                        $('#failure-tp2'+counter).val(data.failureOfFunctionTP2ID)
                        $('#failure-tp3'+counter).val(data.failureOfFunctionTP3ID)

                        $('#passing-tp1'+counter).val(data.passingAccrosValveTP1ID)
                        $('#passing-tp2'+counter).val(data.passingAccrosValveTP2ID)
                        $('#passing-tp3'+counter).val(data.passingAccrosValveTP3ID)


                        //fill ID
                        $('#inspection'+counter).find('#data-id').val(id)
                        $('#inspection'+counter).find('form').addClass('history-form')
                        $('#inspection'+counter).find('.calculate-assessment').first().trigger('change')
                    },
                    error: function (error) {
                        alert('History not found');
                        $('#inspectionheader' + counter).remove();
                        $('#inspection' + counter).remove();
                        moveToLastTab()
                    }
                });
            }

            function fillAssetInfo ({counter, data}) {
                $('#field-assessment-assetid' + counter).val(data.id)
                $('#field-assessment-valvetype' + counter).val(data.valveType)
                $('#field-assessment-tagno' + counter).val(data.tagNo)
                $('#field-assessment-manufacturer' + counter).val(data.manufacturer)
                $('#field-assessment-equipmentname' + counter).val('')
                $('#field-assessment-bodymaterial' + counter).val(data.bodyMaterial)
                $('#field-assessment-businessarea' + counter).val(data.businessArea)
                $('#field-assessment-bodymodel' + counter).val(data.bodyModel)
                $('#field-assessment-platform' + counter).val(data.platform)
                $('#field-assessment-endconnection' + counter).val(data.endConnection)
                $('#field-assessment-parentequipmentno' + counter).val(data.parentEquipmentNo)
                $('#field-assessment-serialno' + counter).val(data.serialNo)
                $('#field-assessment-parentequipmentdesc' + counter).val(data.parentEquipmentDescription)
                $('#field-assessment-usagetype' + counter).val('')
                $('#field-assessment-installationdate' + counter).val(data.installationDate)
                $('#field-assessment-size' + counter).val(data.size)
                $('#field-assessment-pidno' + counter).val(data.pidNo)
                $('#field-assessment-classrating' + counter).val(data.classRating)
                $('#field-assessment-servicefluid' + counter).val(data.serviceFluid)
                $('#field-assessment-fluidphase' + counter).val(data.fluidPhase)
                $('#field-assessment-flowrate' + counter).val(data.flowRate)
                $('#field-assessment-operatingtemperature' + counter).val(data.operatingTemperature)
                $('#field-assessment-operatingpressure' + counter).val(data.operatingPressure)
                $('#field-assessment-toxicorflamableliquid' + counter).val(data.toxicOrFlamableFluid)
                $('#field-assessment-costofreplacement' + counter).val('')
                $('#field-assessment-actuatormfg' + counter).val(data.actuatorMfg)
                $('#field-assessment-actuatorserialno' + counter).val(data.actuatorSerialNo)
                $('#field-assessment-actuatortypemodel' + counter).val(data.actuatorTypeModel)
                $('#field-assessment-actuatorpower' + counter).val(data.actuatorPower)
                $('#field-assessment-manualoverride' + counter).val(data.manualOverride)
                $('#field-assessment-status' + counter).val('')
                $('#field-assessment-actuation' + counter).val('')
            }

            function calculateXPos(value) {
                let gapx = 20;
                let cat1min = 16;
                let cat1max = 49;
                let cat2min = cat1max + 1;
                let cat2max = 210;
                let cat3min = cat2max + 1;
                let cat3max = 891;
                let cat4min = cat3max + 1;
                let cat4max = 3769;
                let cat5min = cat4max + 1;
                let cat5max = 16050;

                value = value*1;
                xpos = 0;
                if(value <= cat1min){
                    xpos = 0;
                } else if(value<=cat1max) {
                    xpos = ((value-cat1min)/(cat1max-cat1min) * 20) + (gapx*0);
                } else if(value<=cat2max) {
                    xpos = ((value-cat2min)/(cat2max-cat2min) * 20) + (gapx*1);
                } else if(value<=cat3max) {
                    xpos = ((value-cat3min)/(cat3max-cat3min) * 20) + (gapx*2);
                } else if(value<=cat4max) {
                    xpos = ((value-cat4min)/(cat4max-cat4min) * 20) + (gapx*3);
                } else if(value<=cat5max) {
                    xpos = ((value-cat5min)/(cat5max-cat5min) * 20) + (gapx*4);
                } else {
                    xpos = 100;
                }
                return xpos;
            }

            function getHeatColor(pos) {
                if(['1A', '2A', '1B'].includes(pos)){
                    return 'olive';
                } else if(['3A', '2B', '1C'].includes(pos)){
                    return 'green';
                } else if(['4A', '3B', '3C', '2C','1D'].includes(pos)){
                    return 'yellow';
                } else if(['5A', '5B', '4B', '4C', '3D', '2D', '2E', '1E'].includes(pos)){
                    return 'orange';
                } else {
                    return 'red';
                }
            }

            function calculateAssessment(ctr = -1) {
                if(ctr == -1){
                    var ctr = $(this).closest('.tab-pane').attr('tab-num');
                }
                if($('#leakage-to-atmosphere' + ctr).find('option:selected').length == 0) {
                    return
                }
                var timePeriod = $('#time-period' + ctr).val();
                var assessmentDate = $('#assessment-date' + ctr).val();
                @* var lastInspectionDate = $('#lastInspectionDate' + ctr).val(); *@
                var lastInspectionDate = $('.tab-pane[tab-num="'+ctr+'"]').find('#lastInspectionDate').val();
                var timeToLimitA = $('#time-to-limit-a' + ctr).val();
                var timeToLimitB = $('#time-to-limit-b' + ctr).val();
                var timeToLimitC = $('#time-to-limit-c' + ctr).val();
                var idImprobable = 1;
                var idDoubtful = 2;
                var idExpected = 3;
                var tp_limit_1 = timePeriod;
                var tp_limit_2 = 2 * timePeriod;
                var tp_limit_3 = 3 * timePeriod;
                var timeToLimitAint = timeToLimitA*1;
                var timeToLimitBint = timeToLimitB*1;
                var timeToLimitCint = timeToLimitC*1;
                // LF2 Leakage to Atmosphere Calculation
                var calculated_lf2LeakageToAtmosphereTP1 = idImprobable;
                var calculated_lf2LeakageToAtmosphereTP2 = idImprobable;
                var calculated_lf2LeakageToAtmosphereTP3 = idImprobable;
                // TP1
                if (timeToLimitAint >= 2 * tp_limit_1) {
                    calculated_lf2LeakageToAtmosphereTP1 = idImprobable;
                } else if (timeToLimitAint > tp_limit_1) {
                    calculated_lf2LeakageToAtmosphereTP1 = idDoubtful;
                } else {
                    calculated_lf2LeakageToAtmosphereTP1 = idExpected;
                }
                // TP2
                if (timeToLimitAint >= 2 * tp_limit_2) {
                    calculated_lf2LeakageToAtmosphereTP2 = idImprobable;
                } else if (timeToLimitAint > tp_limit_2) {
                    calculated_lf2LeakageToAtmosphereTP2 = idDoubtful;
                } else {
                    calculated_lf2LeakageToAtmosphereTP2 = idExpected;
                }
                // TP3
                if (timeToLimitAint >= 2 * tp_limit_3) {
                    calculated_lf2LeakageToAtmosphereTP3 = idImprobable;
                } else if (timeToLimitAint > tp_limit_3) {
                    calculated_lf2LeakageToAtmosphereTP3 = idDoubtful;
                } else {
                    calculated_lf2LeakageToAtmosphereTP3 = idExpected;
                }
                // LF2 Failure of Function Calculation
                var calculated_lf2FailureOfFunctionTP1 = idImprobable;
                var calculated_lf2FailureOfFunctionTP2 = idImprobable;
                var calculated_lf2FailureOfFunctionTP3 = idImprobable;
                // TP1
                if (timeToLimitBint >= 2 * tp_limit_1) {
                    calculated_lf2FailureOfFunctionTP1 = idImprobable;
                } else if (timeToLimitBint > tp_limit_1) {
                    calculated_lf2FailureOfFunctionTP1 = idDoubtful;
                } else {
                    calculated_lf2FailureOfFunctionTP1 = idExpected;
                }
                // TP2
                if (timeToLimitBint >= 2 * tp_limit_2) {
                    calculated_lf2FailureOfFunctionTP2 = idImprobable;
                } else if (timeToLimitBint > tp_limit_2) {
                    calculated_lf2FailureOfFunctionTP2 = idDoubtful;
                } else {
                    calculated_lf2FailureOfFunctionTP2 = idExpected;
                }
                // TP3
                if (timeToLimitBint >= 2 * tp_limit_3) {
                    calculated_lf2FailureOfFunctionTP3 = idImprobable;
                } else if (timeToLimitBint > tp_limit_3) {
                    calculated_lf2FailureOfFunctionTP3 = idDoubtful;
                } else {
                    calculated_lf2FailureOfFunctionTP3 = idExpected;
                }
                // LF2 Passing Accross Valve Calculation
                var calculated_lf2PassingAccrossValveTP1 = idImprobable;
                var calculated_lf2PassingAccrossValveTP2 = idImprobable;
                var calculated_lf2PassingAccrossValveTP3 = idImprobable;
                // TP1
                if (timeToLimitCint >= 2 * tp_limit_1) {
                    calculated_lf2PassingAccrossValveTP1 = idImprobable;
                } else if (timeToLimitCint > tp_limit_1) {
                    calculated_lf2PassingAccrossValveTP1 = idDoubtful;
                } else {
                    calculated_lf2PassingAccrossValveTP1 = idExpected;
                }
                // TP2
                if (timeToLimitCint >= 2 * tp_limit_2) {
                    calculated_lf2PassingAccrossValveTP2 = idImprobable;
                } else if (timeToLimitCint > tp_limit_2) {
                    calculated_lf2PassingAccrossValveTP2 = idDoubtful;
                } else {
                    calculated_lf2PassingAccrossValveTP2 = idExpected;
                }
                // TP3
                if (timeToLimitCint >= 2 * tp_limit_3) {
                    calculated_lf2PassingAccrossValveTP3 = idImprobable;
                } else if (timeToLimitCint > tp_limit_3) {
                    calculated_lf2PassingAccrossValveTP3 = idDoubtful;
                } else {
                    calculated_lf2PassingAccrossValveTP3 = idExpected;
                }
                $('#leakage-tp1' + ctr).val(calculated_lf2LeakageToAtmosphereTP1);
                $('#leakage-tp2' + ctr).val(calculated_lf2LeakageToAtmosphereTP2);
                $('#leakage-tp3' + ctr).val(calculated_lf2LeakageToAtmosphereTP3);
                $('#failure-tp1' + ctr).val(calculated_lf2FailureOfFunctionTP1);
                $('#failure-tp2' + ctr).val(calculated_lf2FailureOfFunctionTP2);
                $('#failure-tp3' + ctr).val(calculated_lf2FailureOfFunctionTP3);
                $('#passing-tp1' + ctr).val(calculated_lf2PassingAccrossValveTP1);
                $('#passing-tp2' + ctr).val(calculated_lf2PassingAccrossValveTP2);
                $('#passing-tp3' + ctr).val(calculated_lf2PassingAccrossValveTP3);
                console.log('calculated', {
                    calculated_lf2LeakageToAtmosphereTP1,
                    calculated_lf2LeakageToAtmosphereTP2,
                    calculated_lf2LeakageToAtmosphereTP3,
                    calculated_lf2FailureOfFunctionTP1,
                    calculated_lf2FailureOfFunctionTP2,
                    calculated_lf2FailureOfFunctionTP3,
                    calculated_lf2PassingAccrossValveTP1,
                    calculated_lf2PassingAccrossValveTP2,
                    calculated_lf2PassingAccrossValveTP3
                })
                //LF1
                var lf1LeakageToAtmosphere = $('#leakage-to-atmosphere' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf1LeakageToAtmosphereWeighting = $('#leakage-to-atmosphere' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                var lf1FailureOfFunction = $('#failure-of-function' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf1FailureOfFunctionWeighting = $('#failure-of-function' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                var lf1PassingAccrossValve = $('#passing-accross-valve' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf1PassingAccrossValveWeighting = $('#passing-accross-valve' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                //LF2
                var lf2LeakageToAtmosphereTP1 = $('#leakage-tp1' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf2LeakageToAtmosphereTP1Weighting = $('#leakage-tp1' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                var lf2LeakageToAtmosphereTP1Value = $('#leakage-tp1' + ctr).find('option:selected').val();
                var lf2LeakageToAtmosphereTP2 = $('#leakage-tp2' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf2LeakageToAtmosphereTP2Weighting = $('#leakage-tp2' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                var lf2LeakageToAtmosphereTP2Value = $('#leakage-tp2' + ctr).find('option:selected').val();
                var lf2LeakageToAtmosphereTP3 = $('#leakage-tp3' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf2LeakageToAtmosphereTP3Weighting = $('#leakage-tp3' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                var lf2LeakageToAtmosphereTP3Value = $('#leakage-tp3' + ctr).find('option:selected').val();
                var lf2FailureOfFunctionTP1 = $('#failure-tp1' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf2FailureOfFunctionTP1Weighting = $('#failure-tp1' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                var lf2FailureOfFunctionTP1Value = $('#failure-tp1' + ctr).find('option:selected').val();
                var lf2FailureOfFunctionTP2 = $('#failure-tp2' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf2FailureOfFunctionTP2Weighting = $('#failure-tp2' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                var lf2FailureOfFunctionTP2Value = $('#failure-tp2' + ctr).find('option:selected').val();
                var lf2FailureOfFunctionTP3 = $('#failure-tp3' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf2FailureOfFunctionTP3Weighting = $('#failure-tp3' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                var lf2FailureOfFunctionTP3Value = $('#failure-tp3' + ctr).find('option:selected').val();
                var lf2PassingAccrossValveTP1 = $('#passing-tp1' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf2PassingAccrossValveTP1Weighting = $('#passing-tp1' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                var lf2PassingAccrossValveTP1Value = $('#passing-tp1' + ctr).find('option:selected').val();
                var lf2PassingAccrossValveTP2 = $('#passing-tp2' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf2PassingAccrossValveTP2Weighting = $('#passing-tp2' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                var lf2PassingAccrossValveTP2Value = $('#passing-tp2' + ctr).find('option:selected').val();
                var lf2PassingAccrossValveTP3 = $('#passing-tp3' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf2PassingAccrossValveTP3Weighting = $('#passing-tp3' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                var lf2PassingAccrossValveTP3Value = $('#passing-tp3' + ctr).find('option:selected').val();
                //LF3
                var lf3InspectionEffectiveness = $('#inspection-effectiveness' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf3InspectionEffectivenessWeighting = $('#inspection-effectiveness' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                //LF4
                var lf4ImpactOfInternalFluid = $('#impact-of-internal-fluid' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf4ImpactOfInternalFluidWeighting = $('#impact-of-internal-fluid' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                //LF5
                var lf5ImpactOfOperatingEnvelopes = $('#impact-of-operating-envelopes' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf5ImpactOfOperatingEnvelopesWeighting = $('#impact-of-operating-envelopes' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                //LF6
                var lf6UsedWithinOEMSpecification = $('#used-within-oem-specification' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf6UsedWithinOEMSpecificationWeighting = $('#used-within-oem-specification' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                //LF7
                var lf7Repaired = $('#repaired' + ctr).find('option:selected').attr('attr-value').replace(',','.');
                var lf7RepairedWeighting = $('#repaired' + ctr).find('option:selected').attr('attr-weighting').replace(',','.');
                //CALCULATE
                // TP1A
                var lofLeakageToAtmosphereA = (lf2LeakageToAtmosphereTP1 * lf2LeakageToAtmosphereTP1Weighting) *
                    (
                        (lf1LeakageToAtmosphere * lf1LeakageToAtmosphereWeighting) +
                        (lf3InspectionEffectiveness * lf3InspectionEffectivenessWeighting) +
                        (lf4ImpactOfInternalFluid * lf4ImpactOfInternalFluidWeighting) +
                        (lf5ImpactOfOperatingEnvelopes * lf5ImpactOfOperatingEnvelopesWeighting) +
                        (lf6UsedWithinOEMSpecification * lf6UsedWithinOEMSpecificationWeighting) +
                        (lf7Repaired * lf7RepairedWeighting)
                    );
                var lofLeakageToAtmosphereAPos = calculateXPos(lofLeakageToAtmosphereA);
                // TP1B
                var lofLeakageToAtmosphereB = (lf2LeakageToAtmosphereTP2 * lf2LeakageToAtmosphereTP2Weighting) *
                    (
                        (lf1LeakageToAtmosphere * lf1LeakageToAtmosphereWeighting) +
                        (lf3InspectionEffectiveness * lf3InspectionEffectivenessWeighting) +
                        (lf4ImpactOfInternalFluid * lf4ImpactOfInternalFluidWeighting) +
                        (lf5ImpactOfOperatingEnvelopes * lf5ImpactOfOperatingEnvelopesWeighting) +
                        (lf6UsedWithinOEMSpecification * lf6UsedWithinOEMSpecificationWeighting) +
                        (lf7Repaired * lf7RepairedWeighting)
                    );
                var lofLeakageToAtmosphereBPos = calculateXPos(lofLeakageToAtmosphereB);
                // TP1C
                var lofLeakageToAtmosphereC = (lf2LeakageToAtmosphereTP3 * lf2LeakageToAtmosphereTP3Weighting) *
                    (
                        (lf1LeakageToAtmosphere * lf1LeakageToAtmosphereWeighting) +
                        (lf3InspectionEffectiveness * lf3InspectionEffectivenessWeighting) +
                        (lf4ImpactOfInternalFluid * lf4ImpactOfInternalFluidWeighting) +
                        (lf5ImpactOfOperatingEnvelopes * lf5ImpactOfOperatingEnvelopesWeighting) +
                        (lf6UsedWithinOEMSpecification * lf6UsedWithinOEMSpecificationWeighting) +
                        (lf7Repaired * lf7RepairedWeighting)
                    );
                var lofLeakageToAtmosphereCPos = calculateXPos(lofLeakageToAtmosphereC);
                // TP2A
                var lofFailureOfFunctionA = (lf2FailureOfFunctionTP1 * lf2FailureOfFunctionTP1Weighting) *
                    (
                        (lf1FailureOfFunction * lf1FailureOfFunctionWeighting) +
                        (lf3InspectionEffectiveness * lf3InspectionEffectivenessWeighting) +
                        (lf4ImpactOfInternalFluid * lf4ImpactOfInternalFluidWeighting) +
                        (lf5ImpactOfOperatingEnvelopes * lf5ImpactOfOperatingEnvelopesWeighting) +
                        (lf6UsedWithinOEMSpecification * lf6UsedWithinOEMSpecificationWeighting) +
                        (lf7Repaired * lf7RepairedWeighting)
                    );
                var lofFailureOfFunctionAPos = calculateXPos(lofFailureOfFunctionA);
                // TP2B
                var lofFailureOfFunctionB = (lf2FailureOfFunctionTP2 * lf2FailureOfFunctionTP2Weighting) *
                    (
                        (lf1FailureOfFunction * lf1FailureOfFunctionWeighting) +
                        (lf3InspectionEffectiveness * lf3InspectionEffectivenessWeighting) +
                        (lf4ImpactOfInternalFluid * lf4ImpactOfInternalFluidWeighting) +
                        (lf5ImpactOfOperatingEnvelopes * lf5ImpactOfOperatingEnvelopesWeighting) +
                        (lf6UsedWithinOEMSpecification * lf6UsedWithinOEMSpecificationWeighting) +
                        (lf7Repaired * lf7RepairedWeighting)
                    );
                var lofFailureOfFunctionBPos = calculateXPos(lofFailureOfFunctionB);
                // TP2C
                var lofFailureOfFunctionC = (lf2FailureOfFunctionTP3 * lf2FailureOfFunctionTP3Weighting) *
                    (
                        (lf1FailureOfFunction * lf1FailureOfFunctionWeighting) +
                        (lf3InspectionEffectiveness * lf3InspectionEffectivenessWeighting) +
                        (lf4ImpactOfInternalFluid * lf4ImpactOfInternalFluidWeighting) +
                        (lf5ImpactOfOperatingEnvelopes * lf5ImpactOfOperatingEnvelopesWeighting) +
                        (lf6UsedWithinOEMSpecification * lf6UsedWithinOEMSpecificationWeighting) +
                        (lf7Repaired * lf7RepairedWeighting)
                    );
                var lofFailureOfFunctionCPos = calculateXPos(lofFailureOfFunctionC);
                // TP3A
                var lofPassingAccrossValveA = (lf2PassingAccrossValveTP1 * lf2PassingAccrossValveTP1Weighting) *
                    (
                        (lf1PassingAccrossValve * lf1PassingAccrossValveWeighting) +
                        (lf3InspectionEffectiveness * lf3InspectionEffectivenessWeighting) +
                        (lf4ImpactOfInternalFluid * lf4ImpactOfInternalFluidWeighting) +
                        (lf5ImpactOfOperatingEnvelopes * lf5ImpactOfOperatingEnvelopesWeighting) +
                        (lf6UsedWithinOEMSpecification * lf6UsedWithinOEMSpecificationWeighting) +
                        (lf7Repaired * lf7RepairedWeighting)
                    );
                var lofPassingAccrossValveAPos = calculateXPos(lofPassingAccrossValveA);
                // TP3B
                var lofPassingAccrossValveB = (lf2PassingAccrossValveTP2 * lf2PassingAccrossValveTP2Weighting) *
                    (
                        (lf1PassingAccrossValve * lf1PassingAccrossValveWeighting) +
                        (lf3InspectionEffectiveness * lf3InspectionEffectivenessWeighting) +
                        (lf4ImpactOfInternalFluid * lf4ImpactOfInternalFluidWeighting) +
                        (lf5ImpactOfOperatingEnvelopes * lf5ImpactOfOperatingEnvelopesWeighting) +
                        (lf6UsedWithinOEMSpecification * lf6UsedWithinOEMSpecificationWeighting) +
                        (lf7Repaired * lf7RepairedWeighting)
                    );
                var lofPassingAccrossValveBPos = calculateXPos(lofPassingAccrossValveB);
                // TP3C
                var lofPassingAccrossValveC = (lf2PassingAccrossValveTP3 * lf2PassingAccrossValveTP3Weighting) *
                    (
                        (lf1PassingAccrossValve * lf1PassingAccrossValveWeighting) +
                        (lf3InspectionEffectiveness * lf3InspectionEffectivenessWeighting) +
                        (lf4ImpactOfInternalFluid * lf4ImpactOfInternalFluidWeighting) +
                        (lf5ImpactOfOperatingEnvelopes * lf5ImpactOfOperatingEnvelopesWeighting) +
                        (lf6UsedWithinOEMSpecification * lf6UsedWithinOEMSpecificationWeighting) +
                        (lf7Repaired * lf7RepairedWeighting)
                    );
                var lofPassingAccrossValveCPos = calculateXPos(lofPassingAccrossValveC);
                //HSSE Value
                var pld = $('#product-loss-definition' + ctr);
                if(pld.val() < 0 || pld.val() == ''){
                    pld.val(0);
                }
                var bbls = Number(pld.val());
                var hsseSelect = $('#hsse-definition-bypld' + ctr);
                var hsseOptions = hsseSelect.find('option');
                var selectedHsse = '';
                hsseOptions.each(function(){
                    var hsseValue = $(this).attr('attr-minvalue')*1;
                    if(bbls >= hsseValue){
                        selectedHsse = $(this).val();
                    }
                });
                hsseSelect.val(selectedHsse);
                var hsseSelectReal = $('#hsse-definition' + ctr);
                if(hsseSelectReal.find('option:selected').length == 0){
                    return
                }
                var cof1 = hsseSelectReal.find('option:selected').attr('attr-cofcategory');
                var cof2 = hsseSelect.find('option:selected').attr('attr-cofcategory');
                var cof = String.fromCharCode(Math.max(cof1.charCodeAt(0), cof2.charCodeAt(0)));
                var cofval = Math.max(hsseSelectReal.find('option:selected').attr('attr-score'), hsseSelect.find('option:selected').attr('attr-score'));
                var cof_rac = [];
                cof_rac['A'] = 3769
                cof_rac['B'] = 891
                cof_rac['C'] = 891
                cof_rac['D'] = 49
                cof_rac['E'] = 49
                var rac = cof_rac[cof];
                $('#consequenceOfFailure' + ctr).val(cof);
                var ypos = 0;
                switch(cof){
                    case 'E':
                        ypos = 10;
                        break;
                    case 'D':
                        ypos = 30;
                        break;
                    case 'C':
                        ypos = 50;
                        break;
                    case 'B':
                        ypos = 70;
                        break;
                    case 'A':
                        ypos = 90;
                        break;
                }
                var tpos1a_lof = Math.floor((lofLeakageToAtmosphereAPos/20)+ 1);
                if(tpos1a_lof > 5){
                    tpos1a_lof = 5;
                }
                var tpos1a = tpos1a_lof + cof;
                $('#tP1A' + ctr).val(tpos1a);
                var tpos1b_lof = Math.floor((lofLeakageToAtmosphereBPos/20)+ 1);
                if(tpos1b_lof > 5){
                    tpos1b_lof = 5;
                }
                var tpos1b = tpos1b_lof + cof;
                $('#tP1B' + ctr).val(tpos1b);
                var tpos1c_lof = Math.floor((lofLeakageToAtmosphereCPos/20)+ 1);
                if(tpos1c_lof > 5){
                    tpos1c_lof = 5;
                }
                var tpos1c = tpos1c_lof + cof;
                $('#tP1C' + ctr).val(tpos1c);
                var tpos2a_lof = Math.floor((lofFailureOfFunctionAPos/20)+ 1);
                if(tpos2a_lof > 5){
                    tpos2a_lof = 5;
                }
                var tpos2a = tpos2a_lof + cof;
                $('#tP2A' + ctr).val(tpos2a);
                var tpos2b_lof = Math.floor((lofFailureOfFunctionBPos/20)+ 1);
                if(tpos2b_lof > 5){
                    tpos2b_lof = 5;
                }
                var tpos2b = tpos2b_lof + cof;
                $('#tP2B' + ctr).val(tpos2b);
                var tpos2c_lof = Math.floor((lofFailureOfFunctionCPos/20)+ 1);
                if(tpos2c_lof > 5){
                    tpos2c_lof = 5;
                }
                var tpos2c = tpos2c_lof + cof;
                $('#tP2C' + ctr).val(tpos2c);
                var tpos3a_lof = Math.floor((lofPassingAccrossValveAPos/20)+ 1);
                if(tpos3a_lof > 5){
                    tpos3a_lof = 5;
                }
                var tpos3a = tpos3a_lof + cof;
                $('#tP3A' + ctr).val(tpos3a);
                var tpos3b_lof = Math.floor((lofPassingAccrossValveBPos/20)+ 1);
                if(tpos3b_lof > 5){
                    tpos3b_lof = 5;
                }
                var tpos3b = tpos3b_lof + cof;
                $('#tP3B' + ctr).val(tpos3b);
                var tpos3c_lof = Math.floor((lofPassingAccrossValveCPos/20)+ 1);
                if(tpos3c_lof > 5){
                    tpos3c_lof = 5;
                }
                var tpos3c = tpos3c_lof + cof;
                $('#tP3C' + ctr).val(tpos3c);
                // TOTAL
                var map_result = {
                    'TP1A': {
                        'lof': Number(lofLeakageToAtmosphereA),
                        'cof': cof,
                        'xpos': Number(lofLeakageToAtmosphereAPos),
                        'ypos': Number(ypos)-8,
                        'label': tpos1a,
                        'color': getHeatColor(tpos1a)
                    },
                    'TP2A': {
                        'lof': Number(lofLeakageToAtmosphereB),
                        'cof': cof,
                        'xpos': Number(lofLeakageToAtmosphereBPos),
                        'ypos': Number(ypos)-6,
                        'label': tpos1b,
                        'color': getHeatColor(tpos1b)
                    },
                    'TP3A': {
                        'lof': Number(lofLeakageToAtmosphereC),
                        'cof': cof,
                        'xpos': Number(lofLeakageToAtmosphereCPos),
                        'ypos': Number(ypos)-4,
                        'label': tpos1c,
                        'color': getHeatColor(tpos1c)
                    },
                    'TP1B': {
                        'lof': Number(lofFailureOfFunctionA),
                        'cof': cof,
                        'xpos': Number(lofFailureOfFunctionAPos),
                        'ypos': Number(ypos)-2,
                        'label': tpos2a,
                        'color': getHeatColor(tpos2a)
                    },
                    'TP2B': {
                        'lof': Number(lofFailureOfFunctionB),
                        'cof': cof,
                        'xpos': Number(lofFailureOfFunctionBPos),
                        'ypos': Number(ypos),
                        'label': tpos2b,
                        'color': getHeatColor(tpos2b)
                    },
                    'TP3B': {
                        'lof': Number(lofFailureOfFunctionC),
                        'cof': cof,
                        'xpos': Number(lofFailureOfFunctionCPos),
                        'ypos': Number(ypos)+2,
                        'label': tpos2c,
                        'color': getHeatColor(tpos2c)
                    },
                    'TP1C': {
                        'lof': Number(lofPassingAccrossValveA),
                        'cof': cof,
                        'xpos': Number(lofPassingAccrossValveAPos),
                        'ypos': Number(ypos)+4,
                        'label': tpos3a,
                        'color': getHeatColor(tpos3a)
                    },
                    'TP2C': {
                        'lof': Number(lofPassingAccrossValveB),
                        'cof': cof,
                        'xpos': Number(lofPassingAccrossValveBPos),
                        'ypos': Number(ypos)+6,
                        'label': tpos3b,
                        'color': getHeatColor(tpos3b)
                    },
                    'TP3C': {
                        'lof': Number(lofPassingAccrossValveC),
                        'cof': cof,
                        'xpos': Number(lofPassingAccrossValveCPos),
                        'ypos': Number(ypos)+8,
                        'label': tpos3c,
                        'color': getHeatColor(tpos3c)
                    }
                }
                console.log(map_result);

                //apply to matrix
                for (const [key, item] of Object.entries(map_result)) {
                    const dot = $('.tab-pane[tab-num='+ctr+']').find('#'+key)
                    dot.css({
                        top: item.ypos+'%',
                        left: item.xpos+'%'
                    })

                    const dotLabel = $('.tab-pane[tab-num='+ctr+']').find('['+key+'-label]')
                    dotLabel.text(item.label)

                    const dotColorLabel = $('.tab-pane[tab-num='+ctr+']').find('['+key+'-colorlabel]')
                    dotColorLabel.removeClass()
                    dotColorLabel.addClass('status-box')
                    dotColorLabel.addClass(item.color)

                    $('.tab-pane[tab-num='+ctr+']').find('#'+key+'-field').val(item.label)
                    $('.tab-pane[tab-num='+ctr+']').find('#'+key+'-value').val(item.lof)
                    $('.tab-pane[tab-num='+ctr+']').find('#COF-value').val(cofval)
                }
                // set cof
                $('.tab-pane[tab-num='+ctr+']').find('#consequenceOfFailure').val(cof)

                // Risk
                var tp1risk = Math.max(tpos1a_lof, tpos2a_lof, tpos3a_lof) + cof;
                var tp2risk = Math.max(tpos1b_lof, tpos2b_lof, tpos3b_lof) + cof;
                var tp3risk = Math.max(tpos1c_lof, tpos3c_lof, tpos3c_lof) + cof;
                var map_risk = {
                    'TP1RISK': {
                        'label' : tp1risk,
                        'color' : getHeatColor(tp1risk)
                    },
                    'TP2RISK': {
                        'label' : tp2risk,
                        'color' : getHeatColor(tp2risk)
                    },
                    'TP3RISK': {
                        'label' : tp3risk,
                        'color' : getHeatColor(tp3risk)
                    }
                }
                console.log(map_risk, 'map_risk');

                // apply to matrix map_risk
                for (const [key, item] of Object.entries(map_risk)) {
                    const dotLabel = $('.tab-pane[tab-num='+ctr+']').find('['+key+'-label]')
                    dotLabel.text(item.label)

                    const dotColorLabel = $('.tab-pane[tab-num='+ctr+']').find('['+key+'-colorlabel]')
                    dotColorLabel.removeClass()
                    dotColorLabel.addClass('status-box')
                    dotColorLabel.addClass(item.color)

                    $('.tab-pane[tab-num='+ctr+']').find('#'+key+'-field').val(item.label)
                }

                //TTL NEW
                var timelimittp1 = timePeriod*1;
                var timelimittp2 = timePeriod*2;
                var timelimittp3 = timePeriod*3;
                var loftp1a = lofLeakageToAtmosphereA;
                var loftp1b = lofFailureOfFunctionA;
                var loftp1c = lofPassingAccrossValveA;
                var loftp2a = lofLeakageToAtmosphereB;
                var loftp2b = lofFailureOfFunctionB;
                var loftp2c = lofPassingAccrossValveB;
                var loftp3a = lofLeakageToAtmosphereC;
                var loftp3b = lofFailureOfFunctionC;
                var loftp3c = lofPassingAccrossValveC;
                var loftp1aval = lf2LeakageToAtmosphereTP1Value;
                var loftp1bval = lf2FailureOfFunctionTP1Value;
                var loftp1cval = lf2PassingAccrossValveTP1Value;
                var loftp2aval = lf2LeakageToAtmosphereTP2Value;
                var loftp2bval = lf2FailureOfFunctionTP2Value;
                var loftp2cval = lf2PassingAccrossValveTP2Value;
                var loftp3aval = lf2LeakageToAtmosphereTP3Value;
                var loftp3bval = lf2FailureOfFunctionTP3Value;
                var loftp3cval = lf2PassingAccrossValveTP3Value;
                var tta_year = decideTTARAC(loftp1a, loftp2a, loftp3a, timelimittp1, timelimittp2, timelimittp3, rac, loftp1aval, loftp2aval, loftp3aval);
                var tta_days = tta_year * 365.25;
                var ttb_year = decideTTARAC(loftp1b, loftp2b, loftp3b, timelimittp1, timelimittp2, timelimittp3, rac, loftp1bval, loftp2bval, loftp3bval);
                var ttb_days = ttb_year * 365.25;
                var ttc_year = decideTTARAC(loftp1c, loftp2c, loftp3c, timelimittp1, timelimittp2, timelimittp3, rac, loftp1cval, loftp2cval, loftp3cval);
                var ttc_days = ttc_year * 365.25;
                var tta_date = new Date(createDateFromString(gLastInspectionDate));
                tta_date.setDate(tta_date.getDate() + tta_days);
                var ttb_date = new Date(createDateFromString(gLastInspectionDate));
                ttb_date.setDate(ttb_date.getDate() + ttb_days);
                var ttc_date = new Date(createDateFromString(gLastInspectionDate));
                ttc_date.setDate(ttc_date.getDate() + ttc_days);
                var map_ttl = {
                    'TPA-TTA': formatDate(tta_date),
                    'TPB-TTA': formatDate(ttb_date),
                    'TPC-TTA': formatDate(ttc_date),
                    'TPRISK-TTA': formatDate(new Date(Math.min(tta_date.getTime(), ttb_date.getTime(), ttc_date.getTime()))),
                };
                console.log(map_ttl, 'map_tt');
                // apply
                for (const [key, item] of Object.entries(map_ttl)) {
                    const dotLabel = $('.tab-pane[tab-num='+ctr+']').find('['+key+']')
                    dotLabel.text(item)
                    $('.tab-pane[tab-num='+ctr+']').find('#'+key+'-field').val(item)
                }
                $('#time-to-action' + ctr).val(map_ttl['TPRISK-TTA']);
            }

            function decideTTARAC(loftp1, loftp2, loftp3, timelimittp1, timelimittp2, timelimittp3, rac, loftp1val, loftp2val, loftp3val){
                console.log("==START DECIDE TTL==");
                console.log("loftp1: "+loftp1);
                console.log("loftp2: "+loftp2);
                console.log("loftp3: "+loftp3);
                console.log("timelimittp1: "+timelimittp1);
                console.log("timelimittp2: "+timelimittp2);
                console.log("timelimittp3: "+timelimittp3);
                console.log("rac: "+rac);
                var calculate = 0;
                if(loftp1 > rac) {
                    calculate = 0;
                }
                else {
                    if (loftp3 > rac && loftp2 <= rac){
                        calculate = ((((timelimittp3-timelimittp2)*(rac-loftp2))/(loftp3-loftp2))/12) + (timelimittp2/12);
                    }
                    else if(loftp2 > rac){
                        calculate = ((((timelimittp2-timelimittp1)*(rac-loftp1))/(loftp2-loftp1))/12) + (timelimittp1/12);
                    }
                    else{
                        calculate = decideTTL(loftp1val, loftp2val, loftp3val, timelimittp1, timelimittp2, timelimittp3)/12;
                    }
                }
                console.log("calculate: "+calculate);
                console.log("==END DECIDE TTL==");
                return calculate;
            }

            function decideTTL(tp1, tp2, tp3, tp1val, tp2val, tp3val){
                /*
                console.log("==START DECIDE TTL==");
                console.log("TP1: "+tp1);
                console.log("TP2: "+tp2);
                console.log("TP3: "+tp3);
                console.log("TP1VAL: "+tp1val);
                console.log("TP2VAL: "+tp2val);
                console.log("TP3VAL: "+tp3val);
                console.log("==END DECIDE TTL==");
                */
                if(tp1 == 1 && tp2 == 1 && tp3 == 1) {
                    return tp3val;
                } else if(tp1 == 1 && tp2 == 1 && tp3 == 2) {
                    return tp3val;
                } else if(tp1 == 1 && tp2 == 2 && tp3 == 2) {
                    return tp2val;
                } else if(tp1 == 2 && tp2 == 2 && tp3 == 2) {
                    return (tp2val + tp3val)/2;
                } else if(tp1 == 2 && tp2 == 2 && tp3 == 3) {
                    return (tp1val + tp2val)/2;
                } else if(tp1 == 2 && tp2 == 3 && tp3 == 3) {
                    return tp1val;
                } else {
                    return 0;
                }
            }

            function createDateFromString(dateString) {
                var parts = dateString.split("-");
                return new Date(parts[2], parts[1] - 1, parts[0]);
            }

            let template_inspection = $('#template_inspection');
            let template_inspection_html = template_inspection.html();
            template_inspection.remove();
            let template_inspection_header = $('#template_inspection_header');
            let template_inspection_header_html = template_inspection_header.html();
            template_inspection_header.remove();

            let idx = 0;
            function addTab () {
                let ctr = idx;

                let id = $(this).attr('attr-id');
                const equipmentId = id
                let isHistory = false
                let name = $(this).attr('attr-name');
                if($(this).attr('attr-inspection-id')) {
                    isHistory = true
                    id = $(this).attr('attr-inspection-id')

                } else {
                    name = `New Assessment ${name}`
                }
                if($('.tab-pane[equipment-id="'+equipmentId+'"]').length > 0){
                    alert('This equipment already exist in the tab');
                    return;
                }

                let tabheadercontainer = $('#inspectiontabheader');
                let tabcontentcontainer = $('#tabcontentcontainer');
                tabheadercontainer.append('<li id="inspectionheader' + ctr + '"><a href="#inspection' + ctr + '" data-bs-toggle="tab" class="nav-link" data-bs-target="#inspection'+ctr+'" type="button" role="tab" tab-num="'+ctr+'"><div tab-title>' + name + '</div><button type="button" class="btn-close-inspection"><i class="fa-solid fa-xmark"></i></button></a></li>');
                tabcontentcontainer.append('<div class="tab-pane" equipment-id="'+equipmentId+'" id="inspection' + ctr + '" tab-num="'+ctr+'">' + template_inspection_html + '</div>');
                let tabcontent = tabcontentcontainer.find('.form-control,.form-select');
                tabcontent.each(function () {
                    let name = $(this).attr('id') + ctr;
                    $(this).attr('id', name);
                });
                //find button submit then add ctr on id
                let submitbtn = tabcontentcontainer.find('.form-submit');
                submitbtn.each(function () {
                    let name = $(this).attr('id') + ctr;
                    $(this).attr('id', name);
                })

                //update the label also
                let tabcontentlabel = tabcontentcontainer.find('label');
                tabcontentlabel.each(function () {
                    let label = $(this).attr('for') + ctr;
                    $(this).attr('for', label);
                });

                $('#inspectionheader' + ctr).find('a').click();
                initDatatable({
                    scrollable: false,
                    selector: `#inspection${ctr} .datatable`
                })
                isHistory ? fetchHistoryData({
                    id,
                    counter: ctr
                }) : fetchAssetData({
                    id,
                    counter: ctr
                })

                initDatepicker()
                moveToLastTab()
                idx++;
            }

            function fetchInspectionHistory(assetId, tabNum, selectedId = []) {
                return new Promise((res, rej) => {
                    const modalId = '#addInspectionModal'
                    const tableSelector = modalId+' .datatable'
                    $(tableSelector).DataTable().destroy()
                    const table = $(tableSelector+ ' tbody')
                    table.html('')
                    $.ajax({
                        url: '@urlassessmentinspection',
                        data: {
                            AssetID: assetId
                        },
                        type: 'GET',
                        success: function (data) {
                            let html = ''
                            data.forEach((item, idx) => {
                                html += `
                                <tr>
                                    <td>${idx+1}</td>
                                    <td>${item.inspectionDate}</td>
                                    <td>${item.inspectionMethod}</td>
                                    <td>${item.inspectionDescription}</td>
                                    <td>${item.functionCondition}</td>
                                    <td>${item.testPressureIfAny}</td>
                                    <td>
                                        <div class="inspection-maintenance-select">
                                            <input id="addInspectionRow${item.id}" ${selectedId.includes(String(item.id)) ? 'checked' : ''} type="checkbox" name="selectedId" value="${item.id}">
                                            <label for="addInspectionRow${item.id}" class="btn btn-light btn-sm">Select</label>
                                        </div>
                                    </td>
                                </tr>
                                `
                            })
                            $(modalId+' input[name=tempData]').val(JSON.stringify(data))
                            $(modalId+' input[name=tabNum]').val(tabNum)
                            table.append(html)
                            res(true)
                        },
                        error: function (error) {
                            rej()
                        }
                    });
                })
            }

            function fetchMaintenanceHistory(assetId, tabNum, selectedId = []) {
                return new Promise((res, ref) => {
                    const modalId = '#addMaintenanceModal'
                    const tableSelector = modalId+' .datatable'
                    $(tableSelector).DataTable().destroy()
                    const table = $(tableSelector+ ' tbody')
                    table.html('')
                    $.ajax({
                        url: '@urlassessmentmaintenance',
                        data: {
                            AssetID: assetId
                        },
                        type: 'GET',
                        success: function (data) {
                            let html = ''
                            data.forEach((item, idx) => {
                                html += `
                                <tr>
                                    <td>${idx+1}</td>
                                    <td>${item.maintenanceDate}</td>
                                    <td>${item.isValveRepaired}</td>
                                    <td>${item.maintenanceDescription}</td>
                                    <td>
                                        <div class="inspection-maintenance-select">
                                            <input id="addInspectionRow${item.id}" ${selectedId.includes(String(item.id)) ? 'checked' : ''} type="checkbox" name="selectedId" value="${item.id}">
                                            <label for="addInspectionRow${item.id}" class="btn btn-light btn-sm">Select</label>
                                        </div>
                                    </td>
                                </tr>
                                `
                            })
                            $(modalId+' input[name=tempData]').val(JSON.stringify(data))
                            $(modalId+' input[name=tabNum]').val(tabNum)
                            table.append(html)
                            res(true)
                        },
                        error: function (error) {
                            rej()
                        }
                    })
                });
            }
        
        $( "#addInspectionModal" ).on('shown.bs.modal', function(){
            // refreshDatatableColumn()
        });
        
        const changeContentCard = (key, el) => {
            const form = $(el).closest('form')
            form.find('.assessment-content-card').removeClass('active');
            form.find('.assessment-content-card.card-group-'+key).addClass('active')
            $(el).closest('.assessment-tab-content-submenu').find('.submenu-item').removeClass('active')
            $(el).addClass('active')
            var ctr = $(el).closest('.tab-pane').attr('tab-num');
            calculateAssessment(ctr)
        }


            /* MODAL CODE */
            function submitInspectionForm(el) {
                const form = $(el).closest('form')
                // const equipmentId = $(el).closest('.tab-pane').attr('equipment-id')
                const ctr = $(el).closest('.tab-pane').attr('tab-num')
                const equipmentId = form.find('#field-inspection-assetid').val()
                
            }

            function submitMaintenanceForm(el) {
                const form = $(el).closest('form')
                // const equipmentId = $(el).closest('.tab-pane').attr('equipment-id')
                const ctr = $(el).closest('.tab-pane').attr('tab-num')
                const equipmentId = form.find('#field-inspection-assetid').val()
                
            }

            function addInspection(el) {
                const form = $(el).closest('form')
                const nativeForm = form[0]
                const formData = new FormData(nativeForm)
                const selectedId = formData.getAll('selectedInspectionId')
                const equipmentId = $(el).closest('.tab-pane').attr('equipment-id')
                const ctr = $(el).closest('.tab-pane').attr('tab-num')

                fetchInspectionHistory(equipmentId,ctr,selectedId).then(() => {
                    initDatatable({
                        scrollable: false,
                        paging: false,
                        selector: `#addInspectionModal .datatable`,
                        scrollable: true
                    })
                    $('#addInspectionModal').modal('show')
                    setTimeout(() => {
                        refreshDatatableColumn()
                    }, 180);
                })
            }

            function confirmInspection(el) {
                const form = $(el).closest('form')
                const nativeForm = form[0]
                const formData = new FormData(nativeForm)
                const selectedId = formData.getAll('selectedId')
                const tempData = JSON.parse(formData.get('tempData'))

                const tabNum = formData.get('tabNum')
                const selectedRows = tempData.filter ( ({id}) => {
                    return selectedId.includes(String(id))
                })
                $('.tab-pane[tab-num='+tabNum+'] .inspection-data-temp').val(JSON.stringify(selectedRows))

                fillInspectionTable(tabNum, selectedRows)
                $('#addInspectionModal').modal('hide')
                refreshDatatableColumn()
            }

            function deleteInspection(el, id) {
                if(confirm('remove inspection?')) {
                    const tabNum = $(el).closest('.tab-pane').attr('tab-num')
                    const tempDataEl = $(el).closest('.card-content').find('.inspection-data-temp')
                    const tempData = JSON.parse(tempDataEl.val()) || []
                    const newData = tempData.filter(item => Number(item.id) !== id)
                    tempDataEl.val(JSON.stringify(newData))
                    fillInspectionTable(tabNum, newData)
                }
            }

            function fillInspectionTable(tabNum, data) {
                const tableSelector = '.tab-pane[tab-num='+tabNum+'] .inspection-table'
                $(tableSelector).DataTable().destroy()
                const table = $(tableSelector+ ' tbody')
                table.html('')

                let html = ''
                data.forEach((item, idx) => {
                    html += `
                    <tr>
                        <td>${idx+1}</td>
                        <td>${item.inspectionDate}</td>
                        <td>${item.inspectionMethod}</td>
                        <td>${item.inspectionDescription}</td>
                        <td>${item.functionCondition}</td>
                        <td>${item.testPressureIfAny}</td>
                        <td>
                            <input type="hidden" name="selectedInspectionId" value="${item.id}" />
                            <a class="btn btn-light btn-sm" onclick="detailInspection(${item.id})">Detail</a>
                            <a class="btn btn-light btn-sm only-add" onclick="deleteInspection(this, ${item.id})">Delete</a>
                        </td>
                    </tr>
                    `
                })
                table.append(html)

                // fill LF1 and LF3
                const latestData = data.at(-1) || {}
                gLastInspectionDate = latestData.inspectionDate
                $('#leakage-to-atmosphere'+tabNum).val(latestData.currentConditionLeakeageToAtmosphereID)
                $('#failure-of-function'+tabNum).val(latestData.currentConditionFailureOfFunctionID)
                $('#passing-accross-valve'+tabNum).val(latestData.currentConditionPassingAcrossValveID)
                $('#inspection-effectiveness'+tabNum).val(latestData.inspectionEffectivenessID)
                initDatatable({
                    scrollable: false,
                    selector: tableSelector
                })

                calculateAssessment(tabNum)
            }

            function addMaintenance(el) {
                const form = $(el).closest('form')
                const nativeForm = form[0]
                const formData = new FormData(nativeForm)
                const selectedId = formData.getAll('selectedMaintenanceId')
                const equipmentId = $(el).closest('.tab-pane').attr('equipment-id')
                const ctr = $(el).closest('.tab-pane').attr('tab-num')

                fetchMaintenanceHistory(equipmentId,ctr,selectedId).then(() => {
                    initDatatable({
                        scrollable: false,
                        paging: false,
                        selector: `#addMaintenanceModal .datatable`,
                        scrollable: true
                    })
                    $('#addMaintenanceModal').modal('show')
                    setTimeout(() => {
                        refreshDatatableColumn()
                    }, 180);
                })
            }

            function deleteMaintenance(el, id) {
                if(confirm('remove maintenance?')) {
                    const tabNum = $(el).closest('.tab-pane').attr('tab-num')
                    const tempDataEl = $(el).closest('.card-content').find('.maintenance-data-temp')
                    const tempData = JSON.parse(tempDataEl.val()) || []
                    const newData = tempData.filter(item => Number(item.id) !== id)
                    tempDataEl.val(JSON.stringify(newData))
                    fillMaintenanceTable(tabNum, newData)
                }
            }

            function confirmMaintenance(el) {
                const form = $(el).closest('form')
                const nativeForm = form[0]
                const formData = new FormData(nativeForm)
                const selectedId = formData.getAll('selectedId')
                const tempData = JSON.parse(formData.get('tempData'))
                const tabNum = formData.get('tabNum')
                const selectedRows = tempData.filter ( ({id}) => {
                    return selectedId.includes(String(id))
                })
                $('.tab-pane[tab-num='+tabNum+'] .maintenance-data-temp').val(JSON.stringify(selectedRows))
                fillMaintenanceTable(tabNum, selectedRows)
                $('#addMaintenanceModal').modal('hide')
                refreshDatatableColumn()
            }

            function fillMaintenanceTable(tabNum, data) {
                const tableSelector = '.tab-pane[tab-num='+tabNum+'] .maintenance-table'
                $(tableSelector).DataTable().destroy()
                const table = $(tableSelector+ ' tbody')
                table.html('')

                let html = ''
                data.forEach((item, idx) => {
                    html += `
                    <tr>
                        <td>${idx+1}</td>
                        <td>${item.maintenanceDate}</td>
                        <td>${item.isValveRepaired}</td>
                        <td>${item.maintenanceDescription}</td>
                        <td>
                            <input type="hidden" name="selectedMaintenanceId" value="${item.id}" />
                            <a class="btn btn-light btn-sm" onclick="detailMaintenance(${item.id})">Detail</a>
                            <a class="btn btn-light btn-sm only-add" onclick="deleteMaintenance(this, ${item.id})">Delete</a>
                        </td>
                    </tr>
                    `
                })
                table.append(html)
                initDatatable({
                    scrollable: false,
                    selector: tableSelector
                })
            }

            function detailInspection(id) {
                $('#detailInspectionModal').find('input,textarea,select').val('')
                $('#detailInspectionModal .preview-image-gallery').find('input[type=file], .single-image').remove()
                fetchModalDetailData(id, 'inspection')

                $('#detailInspectionModal').attr('data-type', 'view')
                $('#detailInspectionModal').modal('show')
            }

            function detailMaintenance(id) {
                $('#detailMaintenanceModal').find('input,textarea,select').val('')
                $('#detailMaintenanceModal .preview-image-gallery').find('input[type=file], .single-image').remove()
                fetchModalDetailData(id, 'maintenance')

                $('#detailMaintenanceModal').attr('data-type', 'view')
                $('#detailMaintenanceModal').modal('show')
            }

            function fetchModalDetailData (id, type) {
            // type = maintenance or inspection
            let endPoint = '@urlinspectiondetail'
            let modalSelector = '#detailInspectionModal'
            if (type === 'maintenance') {
                modalSelector = '#detailMaintenanceModal'
                endPoint = '@urlmaintenancedetail'
            }
            $.ajax({
                url: endPoint,
                type: 'GET',
                data: { id },
                success: function (data) {
                    // $('#field-inspection-valvetagno' + counter).val(data.tagNo);
                    const dataAsset = data.asset
                    $(modalSelector+' #field-inspection-assetid').val(dataAsset.id)
                    $(modalSelector+' #field-inspection-valvetype').val(dataAsset.valveType)
                    $(modalSelector+' #field-inspection-tagno').val(dataAsset.tagNo)
                    $(modalSelector+' #field-inspection-valvetagno').val(dataAsset.tagNo)
                    $(modalSelector+' #field-inspection-manufacturer').val(dataAsset.manufacturer)
                    $(modalSelector+' #field-inspection-equipmentname').val('')
                    $(modalSelector+' #field-inspection-bodymaterial').val(dataAsset.bodyMaterial)
                    $(modalSelector+' #businessarea').val(dataAsset.businessArea)
                    $(modalSelector+' #bodymodel').val(dataAsset.bodyModel)
                    $(modalSelector+' #platform').val(dataAsset.platform)
                    $(modalSelector+' #endconnection').val(dataAsset.endConnection)
                    $(modalSelector+' #parentequipmentno').val(dataAsset.parentEquipmentNo)
                    $(modalSelector+' #serialno').val(dataAsset.serialNo)
                    $(modalSelector+' #parentequipmentdescription').val(dataAsset.parentEquipmentDescription)
                    $(modalSelector+' #usagetype').val('')
                    $(modalSelector+' #installationdate').val(dataAsset.installationDate)
                    $(modalSelector+' #size').val(dataAsset.size)
                    $(modalSelector+' #pidno').val(dataAsset.pidNo)
                    $(modalSelector+' #classrating').val(dataAsset.classRating)

                    // fill history data
                    if(type === 'maintenance') {
                        $(modalSelector + ' #field-maintenance-date').val(data.maintenanceDate)
                        $(modalSelector + ' #field-maintenance-repaired').val(data.isValveRepairedID)
                        $(modalSelector + ' #field-maintenance-description').val(data.maintenanceDescription)
                    } else {
                        $(modalSelector + ' #field-inspection-date').val(data.inspectionDate)
                        $(modalSelector + ' #field-inspection-inspection-method').val(data.inspectionMethodID)
                        $(modalSelector + ' #field-inspection-current-condition-limit-state-a').val(data.currentConditionLeakeageToAtmosphereID)
                        $(modalSelector + ' #field-inspection-current-condition-limit-state-b').val(data.currentConditionFailureOfFunctionID)
                        $(modalSelector + ' #field-inspection-current-condition-limit-state-c').val(data.currentConditionPassingAcrossValveID)
                        $(modalSelector + ' #field-inspection-effectiveness').val(data.inspectionEffectivenessID)
                        $(modalSelector + ' #field-inspection-function-condition').val(data.functionCondition)
                        $(modalSelector + ' #field-inspection-description').val(data.inspectionDescription)
                        $(modalSelector + ' #field-inspection-test-pressure-if-any').val(data.testPressureIfAny)
                    }

                    let galleryHtml = ''
                    data.inspectionFiles.forEach(i => {
                        galleryHtml += `<input type="hidden" identifier="delete-gallery-${i.id}" name="deletedImageIDs[${i.id}]" value="0">
                        <div class="single-image" data-identifier="gallery-${i.id}">
                            <img src="/${i.filePath}"">
                            <div class="delete-image-btn" onclick="deleteGalleryImage('gallery-${i.id}')" style="display: none">
                                <i class="fa-solid fa-xmark"></i>
                            </div>
                        </div>
                        `
                    })

                    //fill image
                    $(modalSelector).find('.preview-image-gallery').append(galleryHtml)
                },
                error: function (error) {
                    alert('History not found');
                }
            });
        }

        </script>
}